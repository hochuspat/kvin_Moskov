{"ast":null,"code":"import { canUseDOM, canUseEventListeners } from \"./dom\";\n/**\n * Функция для js анимации\n * @param {number} duration\n * @param {function} timing тайминг функция анимации\n * @param {function} draw коллбэк, в который прокидывается прогресс [0, 1]\n * @returns {void}\n */\n\nexport function animate(param) {\n  var duration = param.duration,\n      timing = param.timing,\n      draw = param.draw;\n\n  if (!canUseDOM) {\n    return;\n  }\n\n  var start = window.performance.now(); // eslint-disable-next-line no-shadow\n\n  window.requestAnimationFrame(function animate(time) {\n    var timeFraction = (time - start) / duration;\n\n    if (timeFraction > 1) {\n      timeFraction = 1;\n    }\n\n    var progress = timing(timeFraction);\n    draw(progress);\n\n    if (timeFraction < 1) {\n      window.requestAnimationFrame(animate);\n    }\n  });\n} // WebKitAnimationEvent и WebKitTransitionEvent не существуют в глобальном контексте\n\nexport var animationEvent = /*#__PURE__*/function () {\n  var obj = {\n    supported: false,\n    name: \"animationend\"\n  };\n\n  if (canUseDOM) {\n    if (typeof AnimationEvent !== \"undefined\") {\n      obj.supported = true;\n    } else if (typeof WebKitAnimationEvent !== \"undefined\") {\n      obj.supported = true; // webkitAnimationEnd не входит в перечисление событий, но соответствует animationend\n\n      obj.name = \"webkitAnimationEnd\";\n    }\n  }\n\n  return obj;\n}();\nexport var transitionEvent = /*#__PURE__*/function () {\n  var obj = {\n    supported: false,\n    name: \"transitionend\"\n  };\n\n  if (canUseDOM) {\n    if (typeof TransitionEvent !== \"undefined\") {\n      obj.supported = true;\n    } else if (typeof WebKitTransitionEvent !== \"undefined\") {\n      obj.supported = true; // webkitTransitionEnd не входит в перечисление событий, но соответствует transitionend\n\n      obj.name = \"webkitTransitionEnd\";\n    }\n  }\n\n  return obj;\n}();\n/**\n * Ожидание окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\n\nexport function waitAnimationEnd(listener, fallbackTime, el) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.addEventListener(animationEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n/**\n * Прекращение ожидания окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitAnimationEnd```\n * @param el элемент\n */\n\nexport function cancelWaitAnimationEnd(listener, handle, el) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.removeEventListener(animationEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n/**\n * Ожидание окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\n\nexport function waitTransitionEnd(el, listener, fallbackTime) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.addEventListener(transitionEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n/**\n * Прекращение ожидания окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitTransitionEnd```\n * @param el элемент\n */\n\nexport function cancelWaitTransitionEnd(listener, handle, el) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.removeEventListener(transitionEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}","map":{"version":3,"mappings":"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","names":["canUseDOM","canUseEventListeners","animate","param","duration","timing","draw","start","window","performance","now","requestAnimationFrame","time","timeFraction","progress","animationEvent","obj","supported","name","AnimationEvent","WebKitAnimationEvent","transitionEvent","TransitionEvent","WebKitTransitionEvent","waitAnimationEnd","listener","fallbackTime","el","addEventListener","setTimeout","cancelWaitAnimationEnd","handle","removeEventListener","clearTimeout","waitTransitionEnd","cancelWaitTransitionEnd"],"sources":["C:\\Users\\kulag\\vk\\Ability\\node_modules\\@vkontakte\\vkjs\\src\\animate.ts"],"sourcesContent":["import { canUseDOM, canUseEventListeners } from './dom';\nimport { SupportEvent } from './types';\n\ntype TimingInterface = (timeFraction: number) => number;\n\ntype DrawInterface = (progress: number) => void;\n\ninterface AnimateArgumentsInterface {\n  duration: number;\n  timing: TimingInterface;\n  draw: DrawInterface;\n}\n\n/**\n * Функция для js анимации\n * @param {number} duration\n * @param {function} timing тайминг функция анимации\n * @param {function} draw коллбэк, в который прокидывается прогресс [0, 1]\n * @returns {void}\n */\nexport function animate({ duration, timing, draw }: AnimateArgumentsInterface) {\n  if (!canUseDOM) {\n    return;\n  }\n\n  const start = window.performance.now();\n\n  // eslint-disable-next-line no-shadow\n  window.requestAnimationFrame(function animate(time) {\n    let timeFraction = (time - start) / duration;\n\n    if (timeFraction > 1) {\n      timeFraction = 1;\n    }\n\n    const progress = timing(timeFraction);\n\n    draw(progress);\n\n    if (timeFraction < 1) {\n      window.requestAnimationFrame(animate);\n    }\n  });\n}\n\n// WebKitAnimationEvent и WebKitTransitionEvent не существуют в глобальном контексте\ndeclare const WebKitAnimationEvent: AnimationEvent;\ndeclare const WebKitTransitionEvent: TransitionEvent;\n\nexport const animationEvent = /*#__PURE__*/ (() => {\n  const obj: SupportEvent<'animationend'> = {\n    supported: false,\n    name: 'animationend',\n  };\n\n  if (canUseDOM) {\n    if (typeof AnimationEvent !== 'undefined') {\n      obj.supported = true;\n    } else if (typeof WebKitAnimationEvent !== 'undefined') {\n      obj.supported = true;\n\n      // webkitAnimationEnd не входит в перечисление событий, но соответствует animationend\n      obj.name = 'webkitAnimationEnd' as unknown as 'animationend';\n    }\n  }\n\n  return obj;\n})();\n\nexport const transitionEvent = /*#__PURE__*/ (() => {\n  const obj: SupportEvent<'transitionend'> = {\n    supported: false,\n    name: 'transitionend',\n  };\n\n  if (canUseDOM) {\n    if (typeof TransitionEvent !== 'undefined') {\n      obj.supported = true;\n    } else if (typeof WebKitTransitionEvent !== 'undefined') {\n      obj.supported = true;\n\n      // webkitTransitionEnd не входит в перечисление событий, но соответствует transitionend\n      obj.name = 'webkitTransitionEnd' as unknown as 'transitionend';\n    }\n  }\n\n  return obj;\n})();\n\n/**\n * Ожидание окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitAnimationEnd(\n  listener: (ev?: AnimationEvent) => any,\n  fallbackTime: number,\n  el?: GlobalEventHandlers,\n) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.addEventListener(animationEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitAnimationEnd```\n * @param el элемент\n */\nexport function cancelWaitAnimationEnd(\n  listener: (ev?: AnimationEvent) => any,\n  handle?: number,\n  el?: GlobalEventHandlers,\n) {\n  if (canUseEventListeners) {\n    if (animationEvent.supported && el) {\n      el.removeEventListener(animationEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n\n/**\n * Ожидание окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param fallbackTime сколько ждать в мс если событие не поддерживается\n * @param el элемент\n */\nexport function waitTransitionEnd(\n  el: GlobalEventHandlers,\n  listener: (ev?: TransitionEvent) => any,\n  fallbackTime: number,\n) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.addEventListener(transitionEvent.name, listener);\n    } else {\n      return window.setTimeout(listener, fallbackTime);\n    }\n  }\n}\n\n/**\n * Прекращение ожидания окончания анимации перехода на элементе\n *\n * @param listener коллбэк окончания ожидания\n * @param handle то, что вернулось из ```waitTransitionEnd```\n * @param el элемент\n */\nexport function cancelWaitTransitionEnd(\n  listener: (ev?: TransitionEvent) => any,\n  handle?: number,\n  el?: GlobalEventHandlers,\n) {\n  if (canUseEventListeners) {\n    if (transitionEvent.supported && el) {\n      el.removeEventListener(transitionEvent.name, listener);\n    } else {\n      window.clearTimeout(handle);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}