{"ast":null,"code":"import { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport { classNames } from \"@vkontakte/vkjs\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useDOM } from \"../../lib/dom\";\nimport { getNavId } from \"../../lib/getNavId\";\nimport { Platform } from \"../../lib/platform\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { ScrollContext } from \"../AppRoot/ScrollContext\";\nimport { useConfigProvider } from \"../ConfigProvider/ConfigProviderContext\";\nimport { NavTransitionProvider } from \"../NavTransitionContext/NavTransitionContext\";\nimport { NavTransitionDirectionProvider } from \"../NavTransitionDirectionContext/NavTransitionDirectionContext\";\nimport { RootComponent } from \"../RootComponent/RootComponent\";\nimport { SplitColContext } from \"../SplitCol/SplitColContext\";\nvar warn = warnOnce(\"Root\");\n/**\n * @see https://vkcom.github.io/VKUI/#/Root\n */\n\nexport var Root = function (_param) {\n  var children = _param.children,\n      _activeView = _param.activeView,\n      onTransition = _param.onTransition,\n      nav = _param.nav,\n      restProps = _object_without_properties(_param, [\"children\", \"activeView\", \"onTransition\", \"nav\"]);\n\n  var scroll = React.useContext(ScrollContext);\n  var platform = usePlatform();\n  var document = useDOM().document;\n  var scrolls = React.useRef({}).current;\n  var viewNodes = React.useRef({}).current;\n\n  var _useConfigProvider = useConfigProvider(),\n      _useConfigProvider_transitionMotionEnabled = _useConfigProvider.transitionMotionEnabled,\n      transitionMotionEnabled = _useConfigProvider_transitionMotionEnabled === void 0 ? true : _useConfigProvider_transitionMotionEnabled;\n\n  var animate = React.useContext(SplitColContext).animate;\n  var disableAnimation = !transitionMotionEnabled || !animate;\n  var views = React.Children.toArray(children);\n\n  var _React_useState = _sliced_to_array(React.useState({\n    activeView: _activeView,\n    transition: false\n  }), 2),\n      _React_useState_ = _React_useState[0],\n      prevView = _React_useState_.prevView,\n      activeView = _React_useState_.activeView,\n      transition = _React_useState_.transition,\n      isBack = _React_useState_.isBack,\n      _setState = _React_useState[1];\n\n  var transitionTo = function (panel) {\n    if (panel !== activeView) {\n      var viewIds = views.map(function (view) {\n        return getNavId(view.props, warn);\n      });\n      var isBack = viewIds.indexOf(panel) < viewIds.indexOf(activeView);\n      scrolls[activeView] = scroll.getScroll().y;\n\n      _setState({\n        activeView: panel,\n        prevView: activeView,\n        transition: !disableAnimation,\n        isBack: isBack\n      });\n    }\n  };\n\n  var finishTransition = React.useCallback(function () {\n    return _setState({\n      activeView: activeView,\n      prevView: prevView,\n      isBack: isBack,\n      transition: false\n    });\n  }, [activeView, isBack, prevView]);\n  useIsomorphicLayoutEffect(function () {\n    document.activeElement.blur();\n  }, [activeView]); // Нужен переход\n\n  useIsomorphicLayoutEffect(function () {\n    return transitionTo(_activeView);\n  }, [_activeView]);\n  useIsomorphicLayoutEffect(function () {\n    if (!transition && prevView) {\n      // Закончился переход\n      scroll.scrollTo(0, isBack ? scrolls[activeView] : 0);\n      onTransition && onTransition({\n        isBack: Boolean(isBack),\n        from: prevView,\n        to: activeView\n      });\n    }\n  }, [transition, prevView]);\n  var fallbackTransition = useTimeout(finishTransition, platform === Platform.IOS ? 600 : 300);\n  React.useEffect(function () {\n    if (!transition) {\n      fallbackTransition.clear();\n      return;\n    }\n\n    fallbackTransition.set();\n  }, [fallbackTransition, transition]);\n\n  var onAnimationEnd = function (e) {\n    if ([\"vkuiroot-android-animation-hide-back\", \"vkuiroot-android-animation-show-forward\", \"vkuiroot-ios-animation-hide-back\", \"vkuiroot-ios-animation-show-forward\"].includes(e.animationName)) {\n      finishTransition();\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(RootComponent, _object_spread_props(_object_spread({}, restProps), {\n    baseClassName: classNames(\"vkuiRoot\", platform === Platform.IOS && \"vkuiRoot--ios\", transition && \"vkuiRoot--transition\")\n  }), views.map(function (view) {\n    var viewId = getNavId(view.props, warn);\n\n    if (viewId !== activeView && !(transition && viewId === prevView)) {\n      return null;\n    }\n\n    var isTransitionTarget = transition && viewId === (isBack ? prevView : activeView);\n    var compensateScroll = transition && (viewId === prevView || isBack && viewId === activeView);\n\n    var _scrolls_viewId;\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: viewId,\n      ref: function (e) {\n        return viewId && (viewNodes[viewId] = e);\n      },\n      onAnimationEnd: isTransitionTarget ? onAnimationEnd : undefined,\n      className: classNames(\"vkuiRoot__view\", transition && viewId === prevView && isBack && \"vkuiRoot__view--hide-back\", transition && viewId === prevView && !isBack && \"vkuiRoot__view--hide-forward\", transition && viewId === activeView && isBack && \"vkuiRoot__view--show-back\", transition && viewId === activeView && !isBack && \"vkuiRoot__view--show-forward\")\n    }, /*#__PURE__*/React.createElement(NavTransitionDirectionProvider, {\n      isBack: isBack\n    }, /*#__PURE__*/React.createElement(NavTransitionProvider, {\n      entering: transition && viewId === activeView\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"vkuiRoot__scrollCompensation\",\n      style: {\n        marginTop: compensateScroll ? viewId && -((_scrolls_viewId = scrolls[viewId]) !== null && _scrolls_viewId !== void 0 ? _scrolls_viewId : 0) : undefined\n      }\n    }, view))));\n  }));\n};","map":{"version":3,"mappings":"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","names":["React","classNames","usePlatform","useTimeout","useDOM","getNavId","Platform","useIsomorphicLayoutEffect","warnOnce","ScrollContext","useConfigProvider","NavTransitionProvider","NavTransitionDirectionProvider","RootComponent","SplitColContext","warn","Root","children","activeView","_activeView","onTransition","nav","restProps","scroll","useContext","platform","document","scrolls","useRef","current","viewNodes","transitionMotionEnabled","_useConfigProvider_transitionMotionEnabled","animate","disableAnimation","views","Children","toArray","useState","transition","_React_useState_","prevView","isBack","_setState","transitionTo","panel","viewIds","map","view","props","indexOf","getScroll","y","finishTransition","useCallback","activeElement","blur","scrollTo","Boolean","from","to","fallbackTransition","IOS","useEffect","clear","set","onAnimationEnd","e","includes","animationName","baseClassName","viewId","isTransitionTarget","compensateScroll","div","key","ref","undefined","className","entering","style","marginTop"],"sources":["C:\\Users\\kulag\\vk\\Ability\\node_modules\\@vkontakte\\vkui\\src\\components\\Root\\Root.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useDOM } from '../../lib/dom';\nimport { getNavId, NavIdProps } from '../../lib/getNavId';\nimport { Platform } from '../../lib/platform';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { HTMLAttributesWithRootRef } from '../../types';\nimport { ScrollContext } from '../AppRoot/ScrollContext';\nimport { useConfigProvider } from '../ConfigProvider/ConfigProviderContext';\nimport { NavTransitionProvider } from '../NavTransitionContext/NavTransitionContext';\nimport { NavTransitionDirectionProvider } from '../NavTransitionDirectionContext/NavTransitionDirectionContext';\nimport { RootComponent } from '../RootComponent/RootComponent';\nimport { SplitColContext } from '../SplitCol/SplitColContext';\nimport styles from './Root.module.css';\n\nexport interface RootProps extends HTMLAttributesWithRootRef<HTMLDivElement>, NavIdProps {\n  activeView: string;\n  onTransition?(params: { isBack: boolean; from: string; to: string }): void;\n  children: React.ReactElement | Iterable<React.ReactElement>;\n}\n\nexport interface RootState {\n  activeView: string;\n  transition: boolean;\n  isBack?: boolean;\n  prevView?: string;\n}\n\nconst warn = warnOnce('Root');\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Root\n */\nexport const Root = ({\n  children,\n  activeView: _activeView,\n  onTransition,\n  nav,\n  ...restProps\n}: RootProps) => {\n  const scroll = React.useContext(ScrollContext);\n  const platform = usePlatform();\n  const { document } = useDOM();\n  const scrolls = React.useRef<Record<string, number>>({}).current;\n  const viewNodes = React.useRef<Record<string, HTMLElement | null>>({}).current;\n\n  const { transitionMotionEnabled = true } = useConfigProvider();\n  const { animate } = React.useContext(SplitColContext);\n  const disableAnimation = !transitionMotionEnabled || !animate;\n\n  const views = React.Children.toArray(children) as React.ReactElement[];\n\n  const [{ prevView, activeView, transition, isBack }, _setState] = React.useState<RootState>({\n    activeView: _activeView,\n    transition: false,\n  });\n  const transitionTo = (panel: string) => {\n    if (panel !== activeView) {\n      const viewIds = views.map((view) => getNavId(view.props, warn));\n      const isBack = viewIds.indexOf(panel) < viewIds.indexOf(activeView);\n      scrolls[activeView] = scroll.getScroll().y;\n      _setState({\n        activeView: panel,\n        prevView: activeView,\n        transition: !disableAnimation,\n        isBack,\n      });\n    }\n  };\n  const finishTransition = React.useCallback(\n    () => _setState({ activeView, prevView, isBack, transition: false }),\n    [activeView, isBack, prevView],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    (document!.activeElement as HTMLElement).blur();\n  }, [activeView]);\n\n  // Нужен переход\n  useIsomorphicLayoutEffect(() => transitionTo(_activeView), [_activeView]);\n  useIsomorphicLayoutEffect(() => {\n    if (!transition && prevView) {\n      // Закончился переход\n      scroll.scrollTo(0, isBack ? scrolls[activeView] : 0);\n      onTransition &&\n        onTransition({\n          isBack: Boolean(isBack),\n          from: prevView,\n          to: activeView,\n        });\n    }\n  }, [transition, prevView]);\n\n  const fallbackTransition = useTimeout(finishTransition, platform === Platform.IOS ? 600 : 300);\n  React.useEffect(() => {\n    if (!transition) {\n      fallbackTransition.clear();\n      return;\n    }\n    fallbackTransition.set();\n  }, [fallbackTransition, transition]);\n\n  const onAnimationEnd = (e: React.AnimationEvent) => {\n    if (\n      [\n        styles['root-android-animation-hide-back'],\n        styles['root-android-animation-show-forward'],\n        styles['root-ios-animation-hide-back'],\n        styles['root-ios-animation-show-forward'],\n      ].includes(e.animationName)\n    ) {\n      finishTransition();\n    }\n  };\n\n  return (\n    <RootComponent\n      {...restProps}\n      baseClassName={classNames(\n        styles['Root'],\n        platform === Platform.IOS && styles['Root--ios'],\n        transition && styles['Root--transition'],\n      )}\n    >\n      {views.map((view) => {\n        const viewId = getNavId(view.props, warn);\n        if (viewId !== activeView && !(transition && viewId === prevView)) {\n          return null;\n        }\n        const isTransitionTarget = transition && viewId === (isBack ? prevView : activeView);\n        const compensateScroll =\n          transition && (viewId === prevView || (isBack && viewId === activeView));\n        return (\n          <div\n            key={viewId}\n            ref={(e) => viewId && (viewNodes[viewId] = e)}\n            onAnimationEnd={isTransitionTarget ? onAnimationEnd : undefined}\n            className={classNames(\n              styles['Root__view'],\n              transition && viewId === prevView && isBack && styles['Root__view--hide-back'],\n              transition && viewId === prevView && !isBack && styles['Root__view--hide-forward'],\n              transition && viewId === activeView && isBack && styles['Root__view--show-back'],\n              transition && viewId === activeView && !isBack && styles['Root__view--show-forward'],\n            )}\n          >\n            <NavTransitionDirectionProvider isBack={isBack}>\n              <NavTransitionProvider entering={transition && viewId === activeView}>\n                <div\n                  className={styles['Root__scrollCompensation']}\n                  style={{\n                    marginTop: compensateScroll ? viewId && -(scrolls[viewId] ?? 0) : undefined,\n                  }}\n                >\n                  {view}\n                </div>\n              </NavTransitionProvider>\n            </NavTransitionDirectionProvider>\n          </div>\n        );\n      })}\n    </RootComponent>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}