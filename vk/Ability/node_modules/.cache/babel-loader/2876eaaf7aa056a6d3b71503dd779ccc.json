{"ast":null,"code":"import { _ as _define_property } from \"@swc/helpers/_/_define_property\";\nimport { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport { _ as _to_consumable_array } from \"@swc/helpers/_/_to_consumable_array\";\nimport * as React from \"react\";\nimport { classNames, noop } from \"@vkontakte/vkjs\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { useAppearance } from \"../../hooks/useAppearance\";\nimport { useInsets } from \"../../hooks/useInsets\";\nimport { useKeyboardInputTracker } from \"../../hooks/useKeyboardInputTracker\";\nimport { SizeType } from \"../../lib/adaptivity\";\nimport { useDOM } from \"../../lib/dom\";\nimport { isRefObject } from \"../../lib/isRefObject\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { AppRootContext } from \"./AppRootContext\";\nimport { ElementScrollController, GlobalScrollController } from \"./ScrollContext\";\nvar warn = warnOnce(\"AppRoot\");\n\nvar vkuiSizeXClassNames = _define_property({\n  none: \"vkui--sizeX-none\"\n}, SizeType.REGULAR, \"vkui--sizeX-regular\");\n\nvar vkuiLayoutClassNames = {\n  card: \"vkui--layout-card\",\n  plain: \"vkui--layout-plain\"\n};\n\nfunction containerClassNames(layout, sizeX) {\n  var classNames = [];\n\n  if (layout) {\n    classNames.push(vkuiLayoutClassNames[layout]);\n  }\n\n  if (sizeX !== SizeType.COMPACT) {\n    classNames.push(vkuiSizeXClassNames[sizeX]);\n  }\n\n  return classNames;\n}\n\nvar INSET_CUSTOM_PROPERTY_PREFIX = \"--vkui_internal--safe_area_inset_\";\n/**\n * @see https://vkcom.github.io/VKUI/#/AppRoot\n */\n\nexport var AppRoot = function (_param) {\n  var children = _param.children,\n      _param_mode = _param.mode,\n      mode = _param_mode === void 0 ? \"full\" : _param_mode,\n      _param_scroll = _param.scroll,\n      scroll = _param_scroll === void 0 ? \"global\" : _param_scroll,\n      tmp = _param.portalRoot,\n      portalRootProp = tmp === void 0 ? null : tmp,\n      disablePortal = _param.disablePortal,\n      disableParentTransformForPositionFixedElements = _param.disableParentTransformForPositionFixedElements,\n      className = _param.className,\n      safeAreaInsets = _param.safeAreaInsets,\n      layout = _param.layout,\n      props = _object_without_properties(_param, [\"children\", \"mode\", \"scroll\", \"portalRoot\", \"disablePortal\", \"disableParentTransformForPositionFixedElements\", \"className\", \"safeAreaInsets\", \"layout\"]);\n\n  var isKeyboardInputActive = useKeyboardInputTracker();\n  var rootRef = React.useRef(null);\n\n  var _React_useState = _sliced_to_array(React.useState(null), 2),\n      portalRoot = _React_useState[0],\n      setPortalRoot = _React_useState[1];\n\n  var document = useDOM().document;\n  var deprecatedInsets = useInsets(!safeAreaInsets);\n  var insets = safeAreaInsets ? safeAreaInsets : deprecatedInsets;\n  var appearance = useAppearance();\n\n  var _useAdaptivity = useAdaptivity(),\n      hasPointer = _useAdaptivity.hasPointer,\n      _useAdaptivity_sizeX = _useAdaptivity.sizeX,\n      sizeX = _useAdaptivity_sizeX === void 0 ? \"none\" : _useAdaptivity_sizeX;\n\n  if (process.env.NODE_ENV === \"development\") {\n    if (!safeAreaInsets) {\n      // TODO [>=6]: удалить warn\n      warn(\"[@vkontakte/vk-bridge] Интеграция VKUI с @vkontakte/vk-bridge устарела и будет удалена в v6. Используйте хук `useInsets()` из @vkontakte/vk-bridge-react и результат передайте в параметр `safeAreaInsets` (см. https://github.com/VKCOM/VKUI/issues/5049)\"); // prettier-ignore\n    }\n  } // setup portal\n\n\n  useIsomorphicLayoutEffect(function () {\n    var portal = null;\n\n    if (portalRootProp) {\n      if (isRefObject(portalRootProp)) {\n        portal = portalRootProp.current;\n      } else {\n        portal = portalRootProp;\n      }\n    }\n\n    if (!portal) {\n      portal = document.createElement(\"div\");\n      document.body.appendChild(portal);\n    }\n\n    setPortalRoot(portal);\n    return function () {\n      if (!portalRootProp) {\n        var _portal_parentElement;\n\n        portal === null || portal === void 0 ? void 0 : (_portal_parentElement = portal.parentElement) === null || _portal_parentElement === void 0 ? void 0 : _portal_parentElement.removeChild(portal);\n      }\n    };\n  }, [portalRootProp]); // setup root classes\n\n  useIsomorphicLayoutEffect(function () {\n    var _rootRef_current;\n\n    if (mode === \"partial\") {\n      return noop;\n    }\n\n    var parent = (_rootRef_current = rootRef.current) === null || _rootRef_current === void 0 ? void 0 : _rootRef_current.parentElement;\n    var classes = [\"vkui__root\"].concat(mode === \"embedded\" ? \"vkui__root--embedded\" : []);\n\n    if (parent) {\n      var _parent_classList;\n\n      if (mode === \"embedded\" && !disableParentTransformForPositionFixedElements) {\n        parent.style.transform = \"translate3d(0, 0, 0)\";\n      }\n\n      (_parent_classList = parent.classList).add.apply(_parent_classList, _to_consumable_array(classes));\n    }\n\n    return function () {\n      if (parent) {\n        var _parent_classList;\n\n        if (mode === \"embedded\" && !disableParentTransformForPositionFixedElements) {\n          parent.style.transform = \"\";\n        }\n\n        (_parent_classList = parent.classList).remove.apply(_parent_classList, _to_consumable_array(classes));\n      }\n    };\n  }, [disableParentTransformForPositionFixedElements]);\n  useIsomorphicLayoutEffect(function () {\n    if (mode === \"full\") {\n      document.documentElement.classList.add(\"vkui\");\n      return function () {\n        document.documentElement.classList.remove(\"vkui\");\n      };\n    }\n\n    return undefined;\n  }, [document, mode]); // setup insets\n\n  useIsomorphicLayoutEffect(function () {\n    var _rootRef_current;\n\n    if (mode === \"partial\" || !((_rootRef_current = rootRef.current) === null || _rootRef_current === void 0 ? void 0 : _rootRef_current.parentElement)) {\n      return noop;\n    }\n\n    var parent = rootRef.current.parentElement;\n    var key;\n\n    for (key in insets) {\n      if (insets.hasOwnProperty(key) && typeof insets[key] === \"number\") {\n        var inset = insets[key];\n        parent.style.setProperty(INSET_CUSTOM_PROPERTY_PREFIX + key, \"\".concat(inset, \"px\"));\n        portalRoot && portalRoot.style.setProperty(INSET_CUSTOM_PROPERTY_PREFIX + key, \"\".concat(inset, \"px\"));\n      }\n    }\n\n    return function () {\n      var key;\n\n      for (key in insets) {\n        if (insets.hasOwnProperty(key)) {\n          parent.style.removeProperty(INSET_CUSTOM_PROPERTY_PREFIX + key);\n          portalRoot && portalRoot.style.removeProperty(INSET_CUSTOM_PROPERTY_PREFIX + key);\n        }\n      }\n    };\n  }, [insets, portalRoot]); // adaptivity handler\n\n  useIsomorphicLayoutEffect(function () {\n    var _container_classList;\n\n    var _rootRef_current;\n\n    if (mode === \"partial\") {\n      return noop;\n    }\n\n    var _$classNames = containerClassNames(layout, sizeX);\n\n    var container = mode === \"embedded\" ? (_rootRef_current = rootRef.current) === null || _rootRef_current === void 0 ? void 0 : _rootRef_current.parentElement : document.body;\n\n    if (!_$classNames.length || !container) {\n      return noop;\n    }\n\n    (_container_classList = container.classList).add.apply(_container_classList, _to_consumable_array(_$classNames));\n\n    return function () {\n      var _container_classList;\n\n      (_container_classList = container.classList).remove.apply(_container_classList, _to_consumable_array(_$classNames));\n    };\n  }, [sizeX, layout]);\n  useIsomorphicLayoutEffect(function () {\n    if (mode !== \"full\" || appearance === undefined) {\n      return noop;\n    }\n\n    document.documentElement.style.setProperty(\"color-scheme\", appearance);\n    return function () {\n      return document.documentElement.style.removeProperty(\"color-scheme\");\n    };\n  }, [appearance]);\n  var ScrollController = React.useMemo(function () {\n    return scroll === \"contain\" ? ElementScrollController : GlobalScrollController;\n  }, [scroll]);\n  var content = /*#__PURE__*/React.createElement(AppRootContext.Provider, {\n    value: {\n      appRoot: rootRef,\n      portalRoot: portalRoot,\n      embedded: mode === \"embedded\",\n      keyboardInput: isKeyboardInputActive,\n      mode: mode,\n      disablePortal: disablePortal,\n      layout: layout\n    }\n  }, /*#__PURE__*/React.createElement(ScrollController, {\n    elRef: rootRef\n  }, children));\n  return mode === \"partial\" ? content : /*#__PURE__*/React.createElement(\"div\", _object_spread({\n    ref: rootRef,\n    className: classNames(\"vkuiAppRoot\", hasPointer === undefined ? \"vkuiAppRoot--pointer-none\" : !hasPointer && \"vkuiAppRoot--pointer-has-not\", className)\n  }, props), content);\n};","map":{"version":3,"mappings":";;;;;AAAA,YAAYA,KAAZ,MAAuB,OAAvB;AACA,SAASC,UAAT,EAAqBC,IAArB,QAAiC,iBAAjC;AACA,SAASC,aAAT,QAA8B,2BAA9B;AACA,SAASC,aAAT,QAA8B,2BAA9B;AACA,SAASC,SAAT,QAA0B,uBAA1B;AACA,SAASC,uBAAT,QAAwC,qCAAxC;AACA,SAASC,QAAT,QAAyB,sBAAzB;AACA,SAASC,MAAT,QAAuB,eAAvB;AACA,SAASC,WAAT,QAA4B,uBAA5B;AACA,SAASC,yBAAT,QAA0C,qCAA1C;AACA,SAASC,QAAT,QAAyB,oBAAzB;AACA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAASC,uBAAT,EAAkCC,sBAAlC,QAAgE,iBAAhE;AAGA,IAAMC,OAAOJ,SAAS,SAATA,CAAb;;AASA,IAAMK,sBAEJC;EADAC,MAAM;AACN,GAACX,SAASY,OAAV,EAAoB,qBAApB,CAFF;;AAKA,IAAMC,uBAAuB;EAC3BC,MAAM,mBADqB;EAE3BC,OAAO;AAFoB,CAA7B;;AAKA,SAASC,mBAAT,CAA6BC,MAA7B,EAA6DC,KAA7D,EAAqF;EACnF,IAAMxB,aAAuB,EAA7B;;EAEA,IAAIuB,MAAJ,EAAY;IACVvB,WAAWyB,IAAXzB,CAAgBmB,oBAAoB,CAACI,MAAD,CAApCvB;EACF;;EAEA,IAAIwB,UAAUlB,SAASoB,OAAvB,EAAgC;IAC9B1B,WAAWyB,IAAXzB,CAAgBe,mBAAmB,CAACS,KAAD,CAAnCxB;EACF;;EAEA,OAAOA,UAAP;AACF;;AAEA,IAAM2B,+BAAgC,mCAAtC;AA6BA;;;;AAGA,OAAO,IAAMC,UAAU;MACrBC;MAAAA,qBACAC;MAAAA,gCAAO,MAAPA,GAAOC;MAAAC,uBACPC;MAAAA,oCAAS,QAATA,GAASD;MACGE,aAAZC;MAAYD,kCAAiB,IAAjBA;MACZE;MACAC;MACAC;MACAC;MACAhB;MACGiB,4CATHX,UASGW,EARHV,MAQGU,EAPHP,QAOGO,EANHL,YAMGK,EALHJ,eAKGI,EAJHH,gDAIGG,EAHHF,WAGGE,EAFHD,gBAEGC,EADHjB,QACGiB;;EAEH,IAAMC,wBAAwBpC,yBAA9B;EACA,IAAMqC,UAAU3C,MAAM4C,MAAN5C,CAAoC,IAApCA,CAAhB;;EACA,IAAoCA,yCAAM6C,QAAN7C,CAAmC,IAAnCA,GAAmC,CAAnCA,CAApC;EAAA,IAAOoC,aAA6BpC,kBAApC;EAAA,IAAmB8C,gBAAiB9C,kBAApC;;EACA,IAAM+C,QAAEA,GAAavC,SAAbuC,QAAR;EACA,IAAMC,mBAAmB3C,UAAU,CAACmC,cAAXnC,CAAzB;EACA,IAAM4C,SAAST,iBAAiBA,cAAjBA,GAAkCQ,gBAAjD;EACA,IAAME,aAAa9C,eAAnB;;EAEA,IAAuCD,gCAAvC;EAAA,IAAQgD,aAA+BhD,eAA/BgD,UAAR;EAAA,IAAQA,uBAA+BhD,eAAnBsB,KAApB;EAAA,IAAoBA,0CAAQ,MAARA,GAAQ2B,oBAA5B;;EAEA,IAAIC,QAAQC,GAARD,CAAYE,QAAZF,KAAyB,aAA7B,EAA4C;IAC1C,IAAI,CAACb,cAAL,EAAqB;MACnB;MACAzB,KAAK,4PAALA,EAFmB,CAEiP;IACtQ;EACF,CA3BqB,CA6BrB;;;EACAL,0BAA0B;IACxB,IAAI8C,SAA6B,IAAjC;;IACA,IAAIrB,cAAJ,EAAoB;MAClB,IAAI1B,YAAY0B,cAAZ1B,CAAJ,EAAiC;QAC/B+C,SAASrB,eAAesB,OAAxBD;MACF,CAFA,MAEO;QACLA,SAASrB,cAATqB;MACF;IACF;;IACA,IAAI,CAACA,MAAL,EAAa;MACXA,SAAST,SAAUW,aAAVX,CAAwB,KAAxBA,CAATS;MACAT,SAAUY,IAAVZ,CAAea,WAAfb,CAA2BS,MAA3BT;IACF;;IACAD,cAAcU,MAAdV;IACA,OAAO;MACL,IAAI,CAACX,cAAL,EAAqB;YACnBqB;;QAAAA,gFAAQK,aAARL,MAAqB,IAArBA,sEAAuBM,WAAvBN,CAAmCA,MAAnCA;MACF;IACF,CAJA;EAKF,CAnBA9C,EAmBG,CAACyB,cAAD,CAnBHzB,EA9BqB,CAmDrB;;EACAA,0BAA0B;QAKTiC;;IAJf,IAAIZ,SAAS,SAAb,EAAwB;MACtB,OAAO7B,IAAP;IACF;;IAEA,IAAM6D,UAASpB,2BAAQc,OAAjBM,MAAwB,IAAxBA,IAASpB,2BAAToB,GAASpB,MAAToB,GAASpB,iBAAiBkB,aAAhC;IACA,IAAMG,UAAU,CAAC,YAAD,EAAeC,MAAf,CAAsBlC,SAAS,UAATA,GAAsB,sBAAtBA,GAA+C,EAArE,CAAhB;;IACA,IAAIgC,MAAJ,EAAY;UAIVA;;MAHA,IAAIhC,SAAS,UAATA,IAAuB,CAACO,8CAA5B,EAA4E;QAC1EyB,OAAOG,KAAPH,CAAaI,SAAbJ,GAAyB,sBAAzBA;MACF;;MACAA,4BAAOK,SAAPL,EAAiBM,GAAjBN,0BAAqBO,qBAAGN,OAAH,CAArBD;IACF;;IAEA,OAAO;MACL,IAAIA,MAAJ,EAAY;YAIVA;;QAHA,IAAIhC,SAAS,UAATA,IAAuB,CAACO,8CAA5B,EAA4E;UAC1EyB,OAAOG,KAAPH,CAAaI,SAAbJ,GAAyB,EAAzBA;QACF;;QACAA,4BAAOK,SAAPL,EAAiBQ,MAAjBR,0BAAwBO,qBAAGN,OAAH,CAAxBD;MACF;IACF,CAPA;EAQF,CAtBArD,EAsBG,CAAC4B,8CAAD,CAtBH5B;EAwBAA,0BAA0B;IACxB,IAAIqB,SAAS,MAAb,EAAqB;MACnBgB,SAAUyB,eAAVzB,CAA0BqB,SAA1BrB,CAAoCsB,GAApCtB,CAAwC,MAAxCA;MAEA,OAAO;QACLA,SAAUyB,eAAVzB,CAA0BqB,SAA1BrB,CAAoCwB,MAApCxB,CAA2C,MAA3CA;MACF,CAFA;IAGF;;IAEA,OAAO0B,SAAP;EACF,CAVA/D,EAUG,CAACqC,QAAD,EAAWhB,IAAX,CAVHrB,EA5EqB,CAwFrB;;EACAA,0BAA0B;QACGiC;;IAA3B,IAAIZ,SAAS,SAATA,IAAsB,GAACY,2BAAQc,OAAT,MAAgB,IAAhB,IAACd,2BAAD,GAACA,MAAD,GAACA,iBAAiBkB,aAAlB,CAA1B,EAA2D;MACzD,OAAO3D,IAAP;IACF;;IAEA,IAAM6D,SAASpB,QAAQc,OAARd,CAAgBkB,aAA/B;IAEA,IAAIa,GAAJ;;IACA,KAAKA,GAAL,IAAYzB,MAAZ,EAAoB;MAClB,IAAIA,OAAO0B,cAAP1B,CAAsByB,GAAtBzB,KAA8B,OAAOA,MAAM,CAACyB,GAAD,CAAb,KAAuB,QAAzD,EAAmE;QACjE,IAAME,QAAQ3B,MAAM,CAACyB,GAAD,CAApB;QACAX,OAAOG,KAAPH,CAAac,WAAbd,CAAyBnC,+BAA+B8C,GAAxDX,EAA6D,GAASE,MAAT,CAAGW,KAAH,EAAS,IAAT,CAA7Db;QACA3B,cACEA,WAAW8B,KAAX9B,CAAiByC,WAAjBzC,CAA6BR,+BAA+B8C,GAA5DtC,EAAiE,GAAS6B,MAAT,CAAGW,KAAH,EAAS,IAAT,CAAjExC,CADFA;MAEF;IACF;;IAEA,OAAO;MACL,IAAIsC,GAAJ;;MACA,KAAKA,GAAL,IAAYzB,MAAZ,EAAoB;QAClB,IAAIA,OAAO0B,cAAP1B,CAAsByB,GAAtBzB,CAAJ,EAAgC;UAC9Bc,OAAOG,KAAPH,CAAae,cAAbf,CAA4BnC,+BAA+B8C,GAA3DX;UACA3B,cAAcA,WAAW8B,KAAX9B,CAAiB0C,cAAjB1C,CAAgCR,+BAA+B8C,GAA/DtC,CAAdA;QACF;MACF;IACF,CARA;EASF,CA1BA1B,EA0BG,CAACuC,MAAD,EAASb,UAAT,CA1BH1B,EAzFqB,CAqHrB;;EACAA,0BAA0B;QAaxBqE;;QANwCpC;;IANxC,IAAIZ,SAAS,SAAb,EAAwB;MACtB,OAAO7B,IAAP;IACF;;IAEA,IAAMD,eAAasB,oBAAoBC,MAApBD,EAA4BE,KAA5BF,CAAnB;;IAEA,IAAMwD,YAAYhD,SAAS,UAATA,GAAS,CAAaY,2BAAQc,OAArB,MAA4B,IAA5B,IAAad,2BAAb,GAAaA,MAAb,GAAaA,iBAAiBkB,aAAvC9B,GAAuDgB,SAAUY,IAAnF;;IAEA,IAAI,CAAC1D,aAAW+E,MAAZ,IAAsB,CAACD,SAA3B,EAAsC;MACpC,OAAO7E,IAAP;IACF;;IAEA6E,kCAAUX,SAAVW,EAAoBV,GAApBU,6BAAwBT,qBAAGrE,YAAH,CAAxB8E;;IACA,OAAO;UACLA;;MAAAA,kCAAUX,SAAVW,EAAoBR,MAApBQ,6BAA2BT,qBAAGrE,YAAH,CAA3B8E;IACF,CAFA;EAGF,CAjBArE,EAiBG,CAACe,KAAD,EAAQD,MAAR,CAjBHd;EAmBAA,0BAA0B;IACxB,IAAIqB,SAAS,MAATA,IAAmBmB,eAAeuB,SAAtC,EAAiD;MAC/C,OAAOvE,IAAP;IACF;;IACA6C,SAAUyB,eAAVzB,CAA0BmB,KAA1BnB,CAAgC8B,WAAhC9B,CAA4C,cAA5CA,EAA4DG,UAA5DH;IAEA,OAAO;aAAMA,SAAUyB,eAAVzB,CAA0BmB,KAA1BnB,CAAgC+B,cAAhC/B,CAA+C,cAA/CA;KAAb;EACF,CAPArC,EAOG,CAACwC,UAAD,CAPHxC;EASA,IAAMuE,mBAAmBjF,MAAMkF,OAANlF,CACvB;WAAOkC,WAAW,SAAXA,GAAuBrB,uBAAvBqB,GAAiDpB;GADjCd,EAEvB,CAACkC,MAAD,CAFuBlC,CAAzB;EAKA,IAAMmF,uBACJnF,oBAACY,eAAewE,QAAhB,EAAwB;IACtBC,OAAO;MACLC,SAAS3C,OADJ;MAELP,sBAFK;MAGLmD,UAAUxD,SAAS,UAHd;MAILyD,eAAe9C,qBAJV;MAKLX,UALK;MAMLM,4BANK;MAOLb;IAPK;EADe,CAAxB,eAWExB,oBAACiF,gBAAD,EAACA;IAAiBQ,OAAO9C;EAAxBsC,CAAD,EAAmCnD,QAAnC,CAXF,CADF;EAgBA,OAAOC,SAAS,SAATA,GACLoD,OADKpD,GACLoD,aAEAnF,oBAAC0F,KAAD,EAACA;IACCC,KAAKhD,OADN+C;IAECnD,WAAWtC,0BAETkD,eAAesB,SAAftB,GAAesB,2BAAftB,GAEI,CAACA,UAAD,IAACA,8BAJIlD,EAKTsC,SALStC;EAFZyF,GASKjD,KATLiD,CAAD,EAWGP,OAXH,CAHF;AAiBF,CAxLO","names":["React","classNames","noop","useAdaptivity","useAppearance","useInsets","useKeyboardInputTracker","SizeType","useDOM","isRefObject","useIsomorphicLayoutEffect","warnOnce","AppRootContext","ElementScrollController","GlobalScrollController","warn","vkuiSizeXClassNames","_define_property","none","REGULAR","vkuiLayoutClassNames","card","plain","containerClassNames","layout","sizeX","push","COMPACT","INSET_CUSTOM_PROPERTY_PREFIX","AppRoot","children","mode","_param_mode","_param_scroll","scroll","portalRootProp","portalRoot","disablePortal","disableParentTransformForPositionFixedElements","className","safeAreaInsets","props","isKeyboardInputActive","rootRef","useRef","useState","setPortalRoot","document","deprecatedInsets","insets","appearance","hasPointer","_useAdaptivity_sizeX","process","env","NODE_ENV","portal","current","createElement","body","appendChild","parentElement","removeChild","parent","classes","concat","style","transform","classList","add","_to_consumable_array","remove","documentElement","undefined","key","hasOwnProperty","inset","setProperty","removeProperty","container","length","ScrollController","useMemo","content","Provider","value","appRoot","embedded","keyboardInput","elRef","div","ref"],"sources":["C:\\Users\\kulag\\vk\\Ability\\node_modules\\@vkontakte\\vkui\\src\\components\\AppRoot\\AppRoot.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useAppearance } from '../../hooks/useAppearance';\nimport { useInsets } from '../../hooks/useInsets';\nimport { useKeyboardInputTracker } from '../../hooks/useKeyboardInputTracker';\nimport { SizeType } from '../../lib/adaptivity';\nimport { useDOM } from '../../lib/dom';\nimport { isRefObject } from '../../lib/isRefObject';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { AppRootContext } from './AppRootContext';\nimport { ElementScrollController, GlobalScrollController } from './ScrollContext';\nimport styles from './AppRoot.module.css';\n\nconst warn = warnOnce('AppRoot');\n\nexport type SafeAreaInsets = {\n  top?: number;\n  right?: number;\n  bottom?: number;\n  left?: number;\n};\n\nconst vkuiSizeXClassNames = {\n  none: 'vkui--sizeX-none',\n  [SizeType.REGULAR]: 'vkui--sizeX-regular',\n};\n\nconst vkuiLayoutClassNames = {\n  card: 'vkui--layout-card',\n  plain: 'vkui--layout-plain',\n};\n\nfunction containerClassNames(layout: AppRootProps['layout'], sizeX: SizeType | 'none'): string[] {\n  const classNames: string[] = [];\n\n  if (layout) {\n    classNames.push(vkuiLayoutClassNames[layout]);\n  }\n\n  if (sizeX !== SizeType.COMPACT) {\n    classNames.push(vkuiSizeXClassNames[sizeX]);\n  }\n\n  return classNames;\n}\n\nconst INSET_CUSTOM_PROPERTY_PREFIX = `--vkui_internal--safe_area_inset_`;\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends React.HTMLAttributes<HTMLDivElement> {\n  /** Режим встраивания */\n  mode?: 'partial' | 'embedded' | 'full';\n  window?: Window;\n  scroll?: 'global' | 'contain';\n  safeAreaInsets?: SafeAreaInsets;\n  /**\n   * Кастомный root-элемент портала\n   */\n  portalRoot?: HTMLElement | React.RefObject<HTMLElement> | null;\n  /**\n   * Отключает рендер всплывающих компонентов в отдельном контейнере\n   */\n  disablePortal?: boolean;\n  /**\n   * По умолчанию, mode=\"embedded\" переносит систему координат элементов с `position: fixed` на\n   * свой контейнер через `transform: translate3d(0, 0, 0)`.\n   *\n   * Это поведение можно отключить с помощью этого параметра.\n   */\n  disableParentTransformForPositionFixedElements?: boolean;\n  layout?: 'card' | 'plain';\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/AppRoot\n */\nexport const AppRoot = ({\n  children,\n  mode = 'full',\n  scroll = 'global',\n  portalRoot: portalRootProp = null,\n  disablePortal,\n  disableParentTransformForPositionFixedElements,\n  className,\n  safeAreaInsets,\n  layout,\n  ...props\n}: AppRootProps) => {\n  const isKeyboardInputActive = useKeyboardInputTracker();\n  const rootRef = React.useRef<HTMLDivElement | null>(null);\n  const [portalRoot, setPortalRoot] = React.useState<HTMLElement | null>(null);\n  const { document } = useDOM();\n  const deprecatedInsets = useInsets(!safeAreaInsets);\n  const insets = safeAreaInsets ? safeAreaInsets : deprecatedInsets;\n  const appearance = useAppearance();\n\n  const { hasPointer, sizeX = 'none' } = useAdaptivity();\n\n  if (process.env.NODE_ENV === 'development') {\n    if (!safeAreaInsets) {\n      // TODO [>=6]: удалить warn\n      warn(\"[@vkontakte/vk-bridge] Интеграция VKUI с @vkontakte/vk-bridge устарела и будет удалена в v6. Используйте хук `useInsets()` из @vkontakte/vk-bridge-react и результат передайте в параметр `safeAreaInsets` (см. https://github.com/VKCOM/VKUI/issues/5049)\"); // prettier-ignore\n    }\n  }\n\n  // setup portal\n  useIsomorphicLayoutEffect(() => {\n    let portal: HTMLElement | null = null;\n    if (portalRootProp) {\n      if (isRefObject(portalRootProp)) {\n        portal = portalRootProp.current;\n      } else {\n        portal = portalRootProp;\n      }\n    }\n    if (!portal) {\n      portal = document!.createElement('div');\n      document!.body.appendChild(portal);\n    }\n    setPortalRoot(portal);\n    return () => {\n      if (!portalRootProp) {\n        portal?.parentElement?.removeChild(portal);\n      }\n    };\n  }, [portalRootProp]);\n\n  // setup root classes\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial') {\n      return noop;\n    }\n\n    const parent = rootRef.current?.parentElement;\n    const classes = ['vkui__root'].concat(mode === 'embedded' ? 'vkui__root--embedded' : []);\n    if (parent) {\n      if (mode === 'embedded' && !disableParentTransformForPositionFixedElements) {\n        parent.style.transform = 'translate3d(0, 0, 0)';\n      }\n      parent.classList.add(...classes);\n    }\n\n    return () => {\n      if (parent) {\n        if (mode === 'embedded' && !disableParentTransformForPositionFixedElements) {\n          parent.style.transform = '';\n        }\n        parent.classList.remove(...classes);\n      }\n    };\n  }, [disableParentTransformForPositionFixedElements]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'full') {\n      document!.documentElement.classList.add('vkui');\n\n      return () => {\n        document!.documentElement.classList.remove('vkui');\n      };\n    }\n\n    return undefined;\n  }, [document, mode]);\n\n  // setup insets\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial' || !rootRef.current?.parentElement) {\n      return noop;\n    }\n\n    const parent = rootRef.current.parentElement;\n\n    let key: keyof SafeAreaInsets;\n    for (key in insets) {\n      if (insets.hasOwnProperty(key) && typeof insets[key] === 'number') {\n        const inset = insets[key];\n        parent.style.setProperty(INSET_CUSTOM_PROPERTY_PREFIX + key, `${inset}px`);\n        portalRoot &&\n          portalRoot.style.setProperty(INSET_CUSTOM_PROPERTY_PREFIX + key, `${inset}px`);\n      }\n    }\n\n    return () => {\n      let key: keyof SafeAreaInsets;\n      for (key in insets) {\n        if (insets.hasOwnProperty(key)) {\n          parent.style.removeProperty(INSET_CUSTOM_PROPERTY_PREFIX + key);\n          portalRoot && portalRoot.style.removeProperty(INSET_CUSTOM_PROPERTY_PREFIX + key);\n        }\n      }\n    };\n  }, [insets, portalRoot]);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(() => {\n    if (mode === 'partial') {\n      return noop;\n    }\n\n    const classNames = containerClassNames(layout, sizeX);\n\n    const container = mode === 'embedded' ? rootRef.current?.parentElement : document!.body;\n\n    if (!classNames.length || !container) {\n      return noop;\n    }\n\n    container.classList.add(...classNames);\n    return () => {\n      container.classList.remove(...classNames);\n    };\n  }, [sizeX, layout]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (mode !== 'full' || appearance === undefined) {\n      return noop;\n    }\n    document!.documentElement.style.setProperty('color-scheme', appearance);\n\n    return () => document!.documentElement.style.removeProperty('color-scheme');\n  }, [appearance]);\n\n  const ScrollController = React.useMemo(\n    () => (scroll === 'contain' ? ElementScrollController : GlobalScrollController),\n    [scroll],\n  );\n\n  const content = (\n    <AppRootContext.Provider\n      value={{\n        appRoot: rootRef,\n        portalRoot,\n        embedded: mode === 'embedded',\n        keyboardInput: isKeyboardInputActive,\n        mode,\n        disablePortal,\n        layout,\n      }}\n    >\n      <ScrollController elRef={rootRef}>{children}</ScrollController>\n    </AppRootContext.Provider>\n  );\n\n  return mode === 'partial' ? (\n    content\n  ) : (\n    <div\n      ref={rootRef}\n      className={classNames(\n        styles['AppRoot'],\n        hasPointer === undefined\n          ? styles['AppRoot--pointer-none']\n          : !hasPointer && styles['AppRoot--pointer-has-not'],\n        className,\n      )}\n      {...props}\n    >\n      {content}\n    </div>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}