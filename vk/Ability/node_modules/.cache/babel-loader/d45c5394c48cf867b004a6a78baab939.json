{"ast":null,"code":"import { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport { classNames } from \"@vkontakte/vkjs\";\nimport { useEventListener } from \"../../hooks/useEventListener\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { useGlobalEventListener } from \"../../hooks/useGlobalEventListener\";\nimport { usePatchChildrenRef } from \"../../hooks/usePatchChildrenRef\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useDOM } from \"../../lib/dom\";\nimport { FocusTrap } from \"../FocusTrap/FocusTrap\";\nimport { Popper } from \"../Popper/Popper\";\n/**\n * @see https://vkcom.github.io/VKUI/#/Popover\n */\n\nexport var Popover = function (_param) {\n  var _param_action = _param.action,\n      action = _param_action === void 0 ? \"click\" : _param_action,\n      shownProp = _param.shown,\n      _param_showDelay = _param.showDelay,\n      showDelay = _param_showDelay === void 0 ? 150 : _param_showDelay,\n      _param_hideDelay = _param.hideDelay,\n      hideDelay = _param_hideDelay === void 0 ? 150 : _param_hideDelay,\n      _param_offsetDistance = _param.offsetDistance,\n      offsetDistance = _param_offsetDistance === void 0 ? 8 : _param_offsetDistance,\n      content = _param.content,\n      children = _param.children,\n      styleProp = _param.style,\n      className = _param.className,\n      getRef = _param.getRef,\n      onShownChange = _param.onShownChange,\n      _param_restoreFocus = _param.restoreFocus,\n      restoreFocus = _param_restoreFocus === void 0 ? true : _param_restoreFocus,\n      restProps = _object_without_properties(_param, [\"action\", \"shown\", \"showDelay\", \"hideDelay\", \"offsetDistance\", \"content\", \"children\", \"style\", \"className\", \"getRef\", \"onShownChange\", \"restoreFocus\"]);\n\n  var document = useDOM().document;\n  var hoverable = action === \"hover\";\n  var hovered = React.useRef(false);\n\n  var _React_useState = _sliced_to_array(React.useState(shownProp || false), 2),\n      computedShown = _React_useState[0],\n      setComputedShown = _React_useState[1];\n\n  var _React_useState1 = _sliced_to_array(React.useState(null), 2),\n      dropdownNode = _React_useState1[0],\n      setPopperNode = _React_useState1[1];\n\n  var shown = typeof shownProp === \"boolean\" ? shownProp : computedShown;\n  var patchedPopperRef = useExternRef(setPopperNode, getRef);\n\n  var _usePatchChildrenRef = _sliced_to_array(usePatchChildrenRef(children), 2),\n      childRef = _usePatchChildrenRef[0],\n      child = _usePatchChildrenRef[1];\n\n  var setShown = function (value) {\n    if (typeof shownProp !== \"boolean\") {\n      setComputedShown(value);\n    }\n\n    typeof onShownChange === \"function\" && onShownChange(value);\n  };\n\n  var showTimeout = useTimeout(function () {\n    return setShown(true);\n  }, showDelay);\n  var hideTimeout = useTimeout(function () {\n    return setShown(false);\n  }, hideDelay);\n\n  var handleTargetEnter = function () {\n    hovered.current = true;\n    hideTimeout.clear();\n    showTimeout.set();\n  };\n\n  var handleTargetClick = function () {\n    if (hovered.current && shown) {\n      return;\n    }\n\n    setShown(!shown);\n  };\n\n  var handleTargetLeave = function () {\n    hovered.current = false;\n    showTimeout.clear();\n    hideTimeout.set();\n  };\n\n  var handleContentKeyDownEscape = function () {\n    setShown(false);\n  };\n\n  var handleOutsideClick = function (e) {\n    var _childRef_current;\n\n    if (dropdownNode && !((_childRef_current = childRef.current) === null || _childRef_current === void 0 ? void 0 : _childRef_current.contains(e.target)) && !dropdownNode.contains(e.target)) {\n      setShown(false);\n    }\n  };\n\n  useGlobalEventListener(document, \"click\", handleOutsideClick, {\n    capture: true,\n    passive: true\n  });\n  var targetEnterListener = useEventListener(\"mouseenter\", handleTargetEnter);\n  var targetClickEvent = useEventListener(\"click\", handleTargetClick);\n  var targetLeaveListener = useEventListener(\"mouseleave\", handleTargetLeave);\n  React.useEffect(function () {\n    if (!childRef.current) {\n      return;\n    }\n\n    targetClickEvent.add(childRef.current);\n  }, [childRef, targetClickEvent]);\n  React.useEffect(function () {\n    if (!childRef.current) {\n      return;\n    }\n\n    if (hoverable) {\n      targetEnterListener.add(childRef.current);\n      targetLeaveListener.add(childRef.current);\n    }\n\n    return function () {\n      targetEnterListener.remove();\n      targetLeaveListener.remove();\n    };\n  }, [childRef, hoverable, targetEnterListener, targetLeaveListener]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, child, shown && /*#__PURE__*/React.createElement(Popper, _object_spread_props(_object_spread({}, restProps), {\n    className: classNames(\"vkuiPopover\", className),\n    targetRef: childRef,\n    getRef: patchedPopperRef,\n    offsetDistance: offsetDistance,\n    style: // Reason: Typescript ругается на CSS Custom Properties в объекте\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    _object_spread_props(_object_spread({}, styleProp), {\n      \"--vkui_internal--popover_safe_zone_padding\": \"\".concat(offsetDistance, \"px\")\n    }),\n    renderContent: function (param) {\n      var wrapperClassName = param.className;\n      return /*#__PURE__*/React.createElement(FocusTrap, {\n        className: classNames(\"vkuiPopover__in\", wrapperClassName),\n        onClose: handleContentKeyDownEscape,\n        restoreFocus: restoreFocus\n      }, content);\n    },\n    onMouseOver: hoverable ? hideTimeout.clear : undefined,\n    onMouseOut: hoverable ? handleTargetLeave : undefined\n  })));\n};","map":{"version":3,"mappings":"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","names":["React","classNames","useEventListener","useExternRef","useGlobalEventListener","usePatchChildrenRef","useTimeout","useDOM","FocusTrap","Popper","Popover","action","_param_action","shown","shownProp","showDelay","_param_showDelay","_param_hideDelay","hideDelay","_param_offsetDistance","offsetDistance","content","children","style","styleProp","className","getRef","onShownChange","restoreFocus","_param_restoreFocus","restProps","document","hoverable","hovered","useRef","useState","computedShown","setComputedShown","dropdownNode","setPopperNode","patchedPopperRef","childRef","child","setShown","value","showTimeout","hideTimeout","handleTargetEnter","current","clear","set","handleTargetClick","handleTargetLeave","handleContentKeyDownEscape","handleOutsideClick","e","contains","target","capture","passive","targetEnterListener","targetClickEvent","targetLeaveListener","useEffect","add","remove","Fragment","targetRef","_object_spread_props","concat","renderContent","wrapperClassName","onClose","onMouseOver","undefined","onMouseOut"],"sources":["C:\\Users\\kulag\\vk\\Ability\\node_modules\\@vkontakte\\vkui\\src\\components\\Popover\\Popover.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useEventListener } from '../../hooks/useEventListener';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport { usePatchChildrenRef } from '../../hooks/usePatchChildrenRef';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useDOM } from '../../lib/dom';\nimport { FocusTrap, FocusTrapProps } from '../FocusTrap/FocusTrap';\nimport { Popper, PopperCommonProps } from '../Popper/Popper';\nimport styles from './Popover.module.css';\n\nexport interface PopoverProps\n  extends Omit<\n      PopperCommonProps,\n      'arrow' | 'arrowClassName' | 'arrowHeight' | 'arrowPadding' | 'ArrowIcon' | 'content'\n    >,\n    Pick<FocusTrapProps, 'restoreFocus'> {\n  /**\n   * Механика вызова всплывающего окна.\n   *\n   * - `\"click\"` – показывается/скрывается только при нажатии.\n   * - `\"hover\"` – помимо нажатия, будет показываться/скрывается при наведении/отведении мыши.\n   *\n   * > ⚠️`\"hover\"` на тач-устройствах будет работать как `\"click\"`, с одним лишь нюансом, что не будет закрываться\n   * > при повторном нажатии на целевой элемент. Для закрытия необходимо нажать на область вне целевого элемента\n   * > и выпадающего окна.\n   */\n  action?: 'click' | 'hover';\n  /**\n   * Если передан, то всплывающее окно будет показано/скрыто в зависимости от значения свойства.\n   */\n  shown?: boolean;\n  /**\n   * Количество миллисекунд, после которых произойдёт показ всплывающего окна.\n   *\n   * > Используется только для `action=\"hover\"` при наведении/отведении мыши.\n   */\n  showDelay?: number;\n  /**\n   * Количество миллисекунд, после которых произойдёт скрытие всплывающего окна.\n   *\n   * > Используется только для `action=\"hover\"` при наведении/отведении мыши.\n   */\n  hideDelay?: number;\n  /**\n   * Содержимое всплывающего окна.\n   */\n  content?: React.ReactNode;\n  /**\n   * Целевой элемент. Всплывающее окно появится возле него.\n   *\n   * > ⚠️ Если это пользовательский компонент, то он должен предоставлять параметры либо `getRootRef`, либо `ref` для получения ссылки на DOM-узел.\n   */\n  children?: React.ReactElement;\n  /**\n   * Вызывается при каждом изменении видимости всплывающего окна.\n   */\n  onShownChange?(shown: boolean): void;\n}\n\n/**\n * @see https://vkcom.github.io/VKUI/#/Popover\n */\nexport const Popover = ({\n  action = 'click',\n  shown: shownProp,\n  showDelay = 150,\n  hideDelay = 150,\n  offsetDistance = 8,\n  content,\n  children,\n  style: styleProp,\n  className,\n  getRef,\n  onShownChange,\n  restoreFocus = true,\n  ...restProps\n}: PopoverProps) => {\n  const { document } = useDOM();\n\n  const hoverable = action === 'hover';\n  const hovered = React.useRef(false);\n  const [computedShown, setComputedShown] = React.useState(shownProp || false);\n  const [dropdownNode, setPopperNode] = React.useState<HTMLElement | null>(null);\n\n  const shown = typeof shownProp === 'boolean' ? shownProp : computedShown;\n\n  const patchedPopperRef = useExternRef<HTMLDivElement>(setPopperNode, getRef);\n\n  const [childRef, child] = usePatchChildrenRef(children);\n\n  const setShown = (value: boolean) => {\n    if (typeof shownProp !== 'boolean') {\n      setComputedShown(value);\n    }\n    typeof onShownChange === 'function' && onShownChange(value);\n  };\n\n  const showTimeout = useTimeout(() => setShown(true), showDelay);\n\n  const hideTimeout = useTimeout(() => setShown(false), hideDelay);\n\n  const handleTargetEnter = () => {\n    hovered.current = true;\n    hideTimeout.clear();\n    showTimeout.set();\n  };\n\n  const handleTargetClick = () => {\n    if (hovered.current && shown) {\n      return;\n    }\n    setShown(!shown);\n  };\n\n  const handleTargetLeave = () => {\n    hovered.current = false;\n    showTimeout.clear();\n    hideTimeout.set();\n  };\n\n  const handleContentKeyDownEscape = () => {\n    setShown(false);\n  };\n\n  const handleOutsideClick = (e: MouseEvent) => {\n    if (\n      dropdownNode &&\n      !childRef.current?.contains(e.target as Node) &&\n      !dropdownNode.contains(e.target as Node)\n    ) {\n      setShown(false);\n    }\n  };\n\n  useGlobalEventListener(document, 'click', handleOutsideClick, {\n    capture: true,\n    passive: true,\n  });\n  const targetEnterListener = useEventListener('mouseenter', handleTargetEnter);\n  const targetClickEvent = useEventListener('click', handleTargetClick);\n  const targetLeaveListener = useEventListener('mouseleave', handleTargetLeave);\n\n  React.useEffect(() => {\n    if (!childRef.current) {\n      return;\n    }\n\n    targetClickEvent.add(childRef.current);\n  }, [childRef, targetClickEvent]);\n\n  React.useEffect(() => {\n    if (!childRef.current) {\n      return;\n    }\n\n    if (hoverable) {\n      targetEnterListener.add(childRef.current);\n      targetLeaveListener.add(childRef.current);\n    }\n\n    return () => {\n      targetEnterListener.remove();\n      targetLeaveListener.remove();\n    };\n  }, [childRef, hoverable, targetEnterListener, targetLeaveListener]);\n\n  return (\n    <React.Fragment>\n      {child}\n      {shown && (\n        <Popper\n          {...restProps}\n          className={classNames(styles['Popover'], className)}\n          targetRef={childRef}\n          getRef={patchedPopperRef}\n          offsetDistance={offsetDistance}\n          style={\n            // Reason: Typescript ругается на CSS Custom Properties в объекте\n            // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n            {\n              ...styleProp,\n              '--vkui_internal--popover_safe_zone_padding': `${offsetDistance}px`,\n            } as React.CSSProperties\n          }\n          renderContent={({ className: wrapperClassName }) => (\n            <FocusTrap\n              className={classNames(styles['Popover__in'], wrapperClassName)}\n              onClose={handleContentKeyDownEscape}\n              restoreFocus={restoreFocus}\n            >\n              {content}\n            </FocusTrap>\n          )}\n          onMouseOver={hoverable ? hideTimeout.clear : undefined}\n          onMouseOut={hoverable ? handleTargetLeave : undefined}\n        />\n      )}\n    </React.Fragment>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}