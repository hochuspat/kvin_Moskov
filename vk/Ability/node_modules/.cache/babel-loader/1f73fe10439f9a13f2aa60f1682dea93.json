{"ast":null,"code":"import { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport * as React from \"react\";\nimport { classNames, noop } from \"@vkontakte/vkjs\";\nimport { clamp } from \"../../helpers/math\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nimport { usePrevious } from \"../../hooks/usePrevious\";\nimport { useWaitTransitionFinish } from \"../../hooks/useWaitTransitionFinish\";\nimport { useDOM } from \"../../lib/dom\";\nimport { getNavId } from \"../../lib/getNavId\";\nimport { Platform } from \"../../lib/platform\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { useConfigProvider } from \"../ConfigProvider/ConfigProviderContext\";\nimport { FocusTrap } from \"../FocusTrap/FocusTrap\";\nimport { ModalRootContext } from \"./ModalRootContext\";\nimport { useModalManager } from \"./useModalManager\";\nvar warn = warnOnce(\"ModalRoot\");\nexport var ModalRootDesktop = function (param) {\n  var activeModalProp = param.activeModal,\n      children = param.children,\n      _param_noFocusToDialog = param.noFocusToDialog,\n      noFocusToDialog = _param_noFocusToDialog === void 0 ? false : _param_noFocusToDialog,\n      onOpen = param.onOpen,\n      onOpened = param.onOpened,\n      onClose = param.onClose,\n      onClosed = param.onClosed;\n  var maskElementRef = React.useRef(null);\n  var maskAnimationFrame = React.useRef(undefined);\n  var restoreFocusTo = React.useRef(undefined);\n  var document = useDOM().document;\n\n  var _useConfigProvider = useConfigProvider(),\n      hasCustomPanelHeaderAfter = _useConfigProvider.hasCustomPanelHeaderAfter,\n      platform = _useConfigProvider.platform;\n\n  var _useModalManager = useModalManager(activeModalProp, children, onOpen, onOpened, onClose, onClosed, noop),\n      activeModal = _useModalManager.activeModal,\n      exitingModal = _useModalManager.exitingModal,\n      onExit = _useModalManager.onExit,\n      getModalState = _useModalManager.getModalState,\n      enteringModal = _useModalManager.enteringModal,\n      onEnter = _useModalManager.onEnter,\n      onEnteredProp = _useModalManager.onEntered,\n      onExited = _useModalManager.onExited,\n      history = _useModalManager.history,\n      delayEnter = _useModalManager.delayEnter;\n\n  var waitTransitionFinish = useWaitTransitionFinish().waitTransitionFinish;\n  var prevProps = usePrevious({\n    exitingModal: exitingModal,\n    enteringModal: enteringModal,\n    activeModal: activeModal\n  });\n  var modalRootContext = useObjectMemo({\n    updateModalHeight: function () {\n      return undefined;\n    },\n    registerModal: function (_param) {\n      var id = _param.id,\n          data = _object_without_properties(_param, [\"id\"]);\n\n      var _getModalState;\n\n      return Object.assign((_getModalState = getModalState(id)) !== null && _getModalState !== void 0 ? _getModalState : {}, data);\n    },\n    onClose: onExit,\n    isInsideModal: true\n  });\n  var timeout = platform === Platform.IOS ? 400 : 320;\n  var modals = React.Children.toArray(children);\n  /* Анимирует сдвиг модального окна */\n\n  var animateModalOpacity = function (modalState, display) {\n    if (modalState === null || modalState === void 0 ? void 0 : modalState.innerElement) {\n      modalState.innerElement.style.transition = \"\";\n      modalState.innerElement.style.transitionDelay = display && delayEnter ? \"\".concat(timeout, \"ms\") : \"\";\n      modalState.innerElement.style.opacity = display ? \"1\" : \"0\";\n    }\n  };\n  /* Устанавливает прозрачность для полупрозрачной подложки */\n\n\n  var setMaskOpacity = function (modalState) {\n    var forceOpacity = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : null;\n\n    if (forceOpacity === null && (history === null || history === void 0 ? void 0 : history[0]) !== modalState.id) {\n      return;\n    }\n\n    if (maskAnimationFrame.current) {\n      cancelAnimationFrame(maskAnimationFrame.current);\n    }\n\n    maskAnimationFrame.current = requestAnimationFrame(function () {\n      if (maskElementRef.current) {\n        var _modalState_translateY = modalState.translateY,\n            translateY = _modalState_translateY === void 0 ? 0 : _modalState_translateY,\n            _modalState_translateYCurrent = modalState.translateYCurrent,\n            translateYCurrent = _modalState_translateYCurrent === void 0 ? 0 : _modalState_translateYCurrent;\n        var opacity = forceOpacity === null ? 1 - (translateYCurrent - translateY) / (100 - translateY) || 0 : forceOpacity;\n        maskElementRef.current.style.opacity = clamp(opacity, 0, 100).toString();\n      }\n    });\n  };\n\n  var onEntered = function (param) {\n    var id = param.id,\n        modalElement = param.modalElement;\n\n    if (!noFocusToDialog && modalElement && !modalElement.contains(document.activeElement)) {\n      modalElement.focus();\n    }\n\n    onEnteredProp(id);\n  };\n\n  var openModal = function () {\n    if (!enteringModal || !prevProps) {\n      return;\n    }\n\n    var enteringState = getModalState(enteringModal);\n    onEnter(); // Анимация открытия модального окна\n\n    if (!prevProps.exitingModal) {\n      requestAnimationFrame(function () {\n        if (enteringModal === enteringModal && enteringState) {\n          waitTransitionFinish(enteringState.innerElement, function () {\n            return onEntered(enteringState);\n          }, timeout);\n          animateModalOpacity(enteringState, true);\n          setMaskOpacity(enteringState, 1);\n        }\n      });\n      return;\n    } // Переход между модальными окнами без анимации\n\n\n    requestAnimationFrame(function () {\n      if (enteringState === null || enteringState === void 0 ? void 0 : enteringState.innerElement) {\n        enteringState.innerElement.style.transition = \"none\";\n        enteringState.innerElement.style.opacity = \"1\";\n        setMaskOpacity(enteringState, 1);\n      }\n    });\n\n    if (enteringState) {\n      onEntered(enteringState);\n    }\n  };\n\n  var closeModal = function (id) {\n    var prevModalState = getModalState(id);\n\n    if (!prevModalState) {\n      return;\n    } // Анимация закрытия модального окна\n\n\n    if (!activeModal) {\n      requestAnimationFrame(function () {\n        waitTransitionFinish(prevModalState === null || prevModalState === void 0 ? void 0 : prevModalState.innerElement, function () {\n          return onExited(id);\n        }, timeout);\n        animateModalOpacity(prevModalState, false);\n        setMaskOpacity(prevModalState, 0);\n      });\n      return;\n    } // Переход между модальными окнами без анимации\n\n\n    onExited(id);\n  };\n\n  React.useEffect(function () {\n    if (!prevProps) {\n      return;\n    } // transition phase 2: animate exiting modal\n\n\n    if (exitingModal && exitingModal !== prevProps.exitingModal) {\n      closeModal(exitingModal);\n    } // transition phase 3: animate entering modal\n\n\n    if (enteringModal && enteringModal !== prevProps.enteringModal) {\n      openModal();\n    } // focus restoration\n\n\n    if (activeModal && !prevProps.activeModal) {\n      var _document_activeElement;\n\n      restoreFocusTo.current = (_document_activeElement = document === null || document === void 0 ? void 0 : document.activeElement) !== null && _document_activeElement !== void 0 ? _document_activeElement : undefined;\n    }\n\n    if (!activeModal && !exitingModal && restoreFocusTo.current) {\n      restoreFocusTo.current.focus();\n      restoreFocusTo.current = undefined;\n    }\n  });\n\n  if (!activeModal && !exitingModal) {\n    return null;\n  }\n\n  return /*#__PURE__*/React.createElement(ModalRootContext.Provider, {\n    value: modalRootContext\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames(\"vkuiModalRoot\", hasCustomPanelHeaderAfter && \"vkuiModalRoot--hasCustomPanelHeaderAfterSlot\", \"vkuiModalRoot--desktop\")\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiModalRoot__mask\",\n    ref: maskElementRef,\n    onClick: onExit\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiModalRoot__viewport\"\n  }, modals.map(function (Modal) {\n    var modalId = getNavId(Modal.props, warn);\n\n    if (modalId !== activeModal && modalId !== exitingModal) {\n      return null;\n    }\n\n    var key = \"modal-\".concat(modalId);\n    return /*#__PURE__*/React.createElement(FocusTrap, {\n      restoreFocus: false,\n      onClose: onExit,\n      timeout: timeout,\n      key: key,\n      className: \"vkuiModalRoot__modal\"\n    }, Modal);\n  }))));\n};","map":{"version":3,"mappings":"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","names":["React","classNames","noop","clamp","useObjectMemo","usePrevious","useWaitTransitionFinish","useDOM","getNavId","Platform","warnOnce","useConfigProvider","FocusTrap","ModalRootContext","useModalManager","warn","ModalRootDesktop","activeModal","activeModalProp","children","noFocusToDialog","_param_noFocusToDialog","onOpen","onOpened","onClose","onClosed","maskElementRef","useRef","maskAnimationFrame","undefined","restoreFocusTo","document","hasCustomPanelHeaderAfter","platform","exitingModal","onExit","getModalState","enteringModal","onEnter","onEntered","onEnteredProp","onExited","history","delayEnter","waitTransitionFinish","prevProps","modalRootContext","updateModalHeight","registerModal","id","data","Object","assign","isInsideModal","timeout","IOS","modals","Children","toArray","animateModalOpacity","modalState","display","innerElement","style","transition","transitionDelay","concat","opacity","setMaskOpacity","forceOpacity","current","cancelAnimationFrame","requestAnimationFrame","translateY","_modalState_translateY","_modalState_translateYCurrent","translateYCurrent","toString","modalElement","contains","activeElement","focus","openModal","enteringState","closeModal","prevModalState","useEffect","Provider","value","div","className","ref","onClick","map","Modal","modalId","props","key","restoreFocus"],"sources":["C:\\Users\\kulag\\vk\\Ability\\node_modules\\@vkontakte\\vkui\\src\\components\\ModalRoot\\ModalRootDesktop.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport { clamp } from '../../helpers/math';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { usePrevious } from '../../hooks/usePrevious';\nimport { useWaitTransitionFinish } from '../../hooks/useWaitTransitionFinish';\nimport { useDOM } from '../../lib/dom';\nimport { getNavId } from '../../lib/getNavId';\nimport { Platform } from '../../lib/platform';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { useConfigProvider } from '../ConfigProvider/ConfigProviderContext';\nimport { FocusTrap } from '../FocusTrap/FocusTrap';\nimport { ModalRootContext, ModalRootContextInterface } from './ModalRootContext';\nimport { ModalRootWithDOMProps, ModalsStateEntry } from './types';\nimport { useModalManager } from './useModalManager';\nimport styles from './ModalRoot.module.css';\n\nconst warn = warnOnce('ModalRoot');\n\nexport const ModalRootDesktop = ({\n  activeModal: activeModalProp,\n  children,\n  noFocusToDialog = false,\n  onOpen,\n  onOpened,\n  onClose,\n  onClosed,\n}: ModalRootWithDOMProps) => {\n  const maskElementRef = React.useRef<HTMLDivElement>(null);\n  const maskAnimationFrame = React.useRef<number | undefined>(undefined);\n  const restoreFocusTo = React.useRef<HTMLElement | undefined>(undefined);\n\n  const { document } = useDOM();\n  const { hasCustomPanelHeaderAfter, platform } = useConfigProvider();\n  const {\n    activeModal,\n    exitingModal,\n    onExit,\n    getModalState,\n    enteringModal,\n    onEnter,\n    onEntered: onEnteredProp,\n    onExited,\n    history,\n    delayEnter,\n  } = useModalManager(activeModalProp, children, onOpen, onOpened, onClose, onClosed, noop);\n\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n  const prevProps = usePrevious({\n    exitingModal,\n    enteringModal,\n    activeModal,\n  });\n  const modalRootContext: ModalRootContextInterface = useObjectMemo({\n    updateModalHeight: () => undefined,\n    registerModal: ({ id, ...data }) => Object.assign(getModalState(id) ?? {}, data),\n    onClose: onExit,\n    isInsideModal: true,\n  });\n\n  const timeout = platform === Platform.IOS ? 400 : 320;\n  const modals = React.Children.toArray(children) as React.ReactElement[];\n\n  /* Анимирует сдвиг модального окна */\n  const animateModalOpacity = (modalState: ModalsStateEntry | undefined, display: boolean) => {\n    if (modalState?.innerElement) {\n      modalState.innerElement.style.transition = '';\n      modalState.innerElement.style.transitionDelay = display && delayEnter ? `${timeout}ms` : '';\n      modalState.innerElement.style.opacity = display ? '1' : '0';\n    }\n  };\n\n  /* Устанавливает прозрачность для полупрозрачной подложки */\n  const setMaskOpacity = (modalState: ModalsStateEntry, forceOpacity: number | null = null) => {\n    if (forceOpacity === null && history?.[0] !== modalState.id) {\n      return;\n    }\n\n    if (maskAnimationFrame.current) {\n      cancelAnimationFrame(maskAnimationFrame.current);\n    }\n    maskAnimationFrame.current = requestAnimationFrame(() => {\n      if (maskElementRef.current) {\n        const { translateY = 0, translateYCurrent = 0 } = modalState;\n\n        const opacity =\n          forceOpacity === null\n            ? 1 - (translateYCurrent - translateY) / (100 - translateY) || 0\n            : forceOpacity;\n        maskElementRef.current.style.opacity = clamp(opacity, 0, 100).toString();\n      }\n    });\n  };\n\n  const onEntered = ({ id, modalElement }: ModalsStateEntry) => {\n    if (!noFocusToDialog && modalElement && !modalElement.contains(document!.activeElement)) {\n      modalElement.focus();\n    }\n\n    onEnteredProp(id);\n  };\n\n  const openModal = () => {\n    if (!enteringModal || !prevProps) {\n      return;\n    }\n\n    const enteringState = getModalState(enteringModal);\n    onEnter();\n\n    // Анимация открытия модального окна\n    if (!prevProps.exitingModal) {\n      requestAnimationFrame(() => {\n        if (enteringModal === enteringModal && enteringState) {\n          waitTransitionFinish(enteringState.innerElement, () => onEntered(enteringState), timeout);\n          animateModalOpacity(enteringState, true);\n          setMaskOpacity(enteringState, 1);\n        }\n      });\n\n      return;\n    }\n\n    // Переход между модальными окнами без анимации\n    requestAnimationFrame(() => {\n      if (enteringState?.innerElement) {\n        enteringState.innerElement.style.transition = 'none';\n        enteringState.innerElement.style.opacity = '1';\n        setMaskOpacity(enteringState, 1);\n      }\n    });\n\n    if (enteringState) {\n      onEntered(enteringState);\n    }\n  };\n\n  const closeModal = (id: string) => {\n    const prevModalState = getModalState(id);\n    if (!prevModalState) {\n      return;\n    }\n\n    // Анимация закрытия модального окна\n    if (!activeModal) {\n      requestAnimationFrame(() => {\n        waitTransitionFinish(prevModalState?.innerElement, () => onExited(id), timeout);\n        animateModalOpacity(prevModalState, false);\n        setMaskOpacity(prevModalState, 0);\n      });\n\n      return;\n    }\n\n    // Переход между модальными окнами без анимации\n    onExited(id);\n  };\n\n  React.useEffect(() => {\n    if (!prevProps) {\n      return;\n    }\n\n    // transition phase 2: animate exiting modal\n    if (exitingModal && exitingModal !== prevProps.exitingModal) {\n      closeModal(exitingModal);\n    }\n\n    // transition phase 3: animate entering modal\n    if (enteringModal && enteringModal !== prevProps.enteringModal) {\n      openModal();\n    }\n\n    // focus restoration\n    if (activeModal && !prevProps.activeModal) {\n      restoreFocusTo.current = (document?.activeElement ?? undefined) as HTMLElement | undefined;\n    }\n    if (!activeModal && !exitingModal && restoreFocusTo.current) {\n      restoreFocusTo.current.focus();\n      restoreFocusTo.current = undefined;\n    }\n  });\n\n  if (!activeModal && !exitingModal) {\n    return null;\n  }\n\n  return (\n    <ModalRootContext.Provider value={modalRootContext}>\n      <div\n        className={classNames(\n          styles['ModalRoot'],\n          hasCustomPanelHeaderAfter && styles['ModalRoot--hasCustomPanelHeaderAfterSlot'],\n          styles['ModalRoot--desktop'],\n        )}\n      >\n        <div className={styles['ModalRoot__mask']} ref={maskElementRef} onClick={onExit} />\n        <div className={styles['ModalRoot__viewport']}>\n          {modals.map((Modal: React.ReactElement) => {\n            const modalId = getNavId(Modal.props, warn);\n            if (modalId !== activeModal && modalId !== exitingModal) {\n              return null;\n            }\n\n            const key = `modal-${modalId}`;\n\n            return (\n              <FocusTrap\n                restoreFocus={false}\n                onClose={onExit}\n                timeout={timeout}\n                key={key}\n                className={styles['ModalRoot__modal']}\n              >\n                {Modal}\n              </FocusTrap>\n            );\n          })}\n        </div>\n      </div>\n    </ModalRootContext.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}