{"ast":null,"code":"import { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport * as React from \"react\";\nimport { classNames } from \"@vkontakte/vkjs\";\nimport { useAdaptivityHasPointer } from \"../../../hooks/useAdaptivityHasPointer\";\nimport { useExternRef } from \"../../../hooks/useExternRef\";\nimport { useGlobalEventListener } from \"../../../hooks/useGlobalEventListener\";\nimport { useDOM } from \"../../../lib/dom\";\nimport { useIsomorphicLayoutEffect } from \"../../../lib/useIsomorphicLayoutEffect\";\nimport { warnOnce } from \"../../../lib/warnOnce\";\nimport { RootComponent } from \"../../RootComponent/RootComponent\";\nimport { ScrollArrow } from \"../../ScrollArrow/ScrollArrow\";\nimport { Touch } from \"../../Touch/Touch\";\nimport { ANIMATION_DURATION, CONTROL_ELEMENTS_STATE, SLIDES_MANAGER_STATE } from \"./constants\";\nimport { calculateIndent, getLoopPoints, getTargetIndex } from \"./helpers\";\nimport { useSlideAnimation } from \"./hooks\";\nvar stylesBullets = {\n  dark: \"vkuiBaseGallery__bullets--dark\",\n  light: \"vkuiBaseGallery__bullets--light\"\n};\nvar warn = warnOnce(\"Gallery\");\nexport var CarouselBase = function (_param) {\n  var _param_bullets = _param.bullets,\n      bullets = _param_bullets === void 0 ? false : _param_bullets,\n      getRootRef = _param.getRootRef,\n      children = _param.children,\n      _param_slideWidth = _param.slideWidth,\n      slideWidth = _param_slideWidth === void 0 ? \"100%\" : _param_slideWidth,\n      _param_slideIndex = _param.slideIndex,\n      slideIndex = _param_slideIndex === void 0 ? 0 : _param_slideIndex,\n      tmp = _param.isDraggable,\n      isDraggableProp = tmp === void 0 ? true : tmp,\n      onDragStart = _param.onDragStart,\n      onDragEnd = _param.onDragEnd,\n      onChange = _param.onChange,\n      onPrevClick = _param.onPrevClick,\n      onNextClick = _param.onNextClick,\n      _param_align = _param.align,\n      align = _param_align === void 0 ? \"left\" : _param_align,\n      showArrows = _param.showArrows,\n      getRef = _param.getRef,\n      _param_arrowSize = _param.arrowSize,\n      arrowSize = _param_arrowSize === void 0 ? \"l\" : _param_arrowSize,\n      restProps = _object_without_properties(_param, [\"bullets\", \"getRootRef\", \"children\", \"slideWidth\", \"slideIndex\", \"isDraggable\", \"onDragStart\", \"onDragEnd\", \"onChange\", \"onPrevClick\", \"onNextClick\", \"align\", \"showArrows\", \"getRef\", \"arrowSize\"]);\n\n  var slidesStore = React.useRef({});\n  var slidesManager = React.useRef(SLIDES_MANAGER_STATE);\n  var rootRef = useExternRef(getRootRef);\n  var viewportRef = useExternRef(getRef);\n  var layerRef = React.useRef(null);\n  var animationFrameRef = React.useRef(null);\n  var shiftXCurrentRef = React.useRef(0);\n  var shiftXDeltaRef = React.useRef(0);\n  var initialized = React.useRef(false);\n\n  var _useSlideAnimation = useSlideAnimation(),\n      addToAnimationQueue = _useSlideAnimation.addToAnimationQueue,\n      getAnimateFunction = _useSlideAnimation.getAnimateFunction,\n      startAnimation = _useSlideAnimation.startAnimation;\n\n  var _React_useState = _sliced_to_array(React.useState(CONTROL_ELEMENTS_STATE), 2),\n      controlElementsState = _React_useState[0],\n      setControlElementsState = _React_useState[1];\n\n  var window = useDOM().window;\n  var hasPointer = useAdaptivityHasPointer();\n  var isCenterWithCustomWidth = slideWidth === \"custom\" && align === \"center\";\n\n  var transformCssStyles = function (shiftX) {\n    var animation = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : false;\n    slidesManager.current.loopPoints.forEach(function (loopPoint) {\n      var target = loopPoint.target,\n          index = loopPoint.index;\n      var slide = slidesStore.current[index];\n\n      if (slide) {\n        slide.style.transform = \"translate3d(\".concat(target(shiftX), \"px, 0, 0)\");\n      }\n    });\n\n    if (layerRef.current) {\n      layerRef.current.style.transform = \"translate3d(\".concat(shiftX, \"px, 0, 0)\");\n      layerRef.current.style.transition = animation ? \"transform \".concat(ANIMATION_DURATION, \"ms cubic-bezier(.1, 0, .25, 1)\") : \"\";\n    }\n  };\n\n  var requestTransform = function (shiftX) {\n    var animation = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : false;\n    var _slidesManager_current = slidesManager.current,\n        snaps = _slidesManager_current.snaps,\n        contentSize = _slidesManager_current.contentSize,\n        slides = _slidesManager_current.slides;\n\n    if (animationFrameRef.current !== null) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n\n    animationFrameRef.current = requestAnimationFrame(function () {\n      if (shiftX > snaps[0]) {\n        shiftXCurrentRef.current = -contentSize + snaps[0];\n        shiftX = shiftXCurrentRef.current + shiftXDeltaRef.current;\n      }\n\n      var lastPoint = slides[slides.length - 1].width + slides[slides.length - 1].coordX;\n\n      if (shiftX <= -lastPoint) {\n        shiftXCurrentRef.current = Math.abs(shiftXDeltaRef.current) + snaps[0];\n      }\n\n      transformCssStyles(shiftX, animation);\n    });\n  };\n\n  var initializeSlides = function () {\n    if (!rootRef.current || !viewportRef.current) {\n      return;\n    }\n\n    var localSlides = React.Children.map(children, function (_item, i) {\n      var elem = slidesStore.current[i] || {\n        offsetLeft: 0,\n        offsetWidth: 0\n      };\n      return {\n        coordX: elem.offsetLeft,\n        width: elem.offsetWidth\n      };\n    }) || [];\n    var containerWidth = rootRef.current.offsetWidth;\n    var viewportOffsetWidth = viewportRef.current.offsetWidth;\n    var layerWidth = localSlides.reduce(function (val, slide) {\n      return slide.width + val;\n    }, 0);\n\n    if (process.env.NODE_ENV === \"development\") {\n      var remainingWidth = containerWidth;\n      var slideIndex1 = 0;\n\n      while (remainingWidth > 0 && slideIndex1 < localSlides.length) {\n        remainingWidth -= localSlides[slideIndex1].width;\n        slideIndex1++;\n      }\n\n      if (remainingWidth <= 0 && slideIndex1 === localSlides.length) {\n        warn('Ширины слайдов недостаточно для корректной работы свойства \"looped\". Пожалуйста, сделайте её больше.\"');\n      }\n    }\n\n    if (align === \"center\") {\n      var firstSlideShift = (containerWidth - localSlides[0].width) / 2;\n      localSlides = localSlides.map(function (item) {\n        return {\n          width: item.width,\n          coordX: item.coordX - firstSlideShift\n        };\n      });\n    }\n\n    slidesManager.current = _object_spread_props(_object_spread({}, slidesManager.current), {\n      viewportOffsetWidth: viewportOffsetWidth,\n      slides: localSlides,\n      isFullyVisible: layerWidth <= containerWidth\n    });\n    var snaps = localSlides.map(function (_, index) {\n      return calculateIndent(index, slidesManager.current, isCenterWithCustomWidth);\n    });\n    var contentSize = -snaps[snaps.length - 1] + localSlides[localSlides.length - 1].width;\n\n    if (align === \"center\") {\n      contentSize += snaps[0];\n    }\n\n    slidesManager.current.snaps = snaps;\n    slidesManager.current.contentSize = contentSize;\n    slidesManager.current.loopPoints = getLoopPoints(slidesManager.current, containerWidth);\n    setControlElementsState({\n      canSlideLeft: !slidesManager.current.isFullyVisible,\n      canSlideRight: !slidesManager.current.isFullyVisible,\n      isDraggable: isDraggableProp && !slidesManager.current.isFullyVisible\n    });\n    shiftXCurrentRef.current = snaps[slideIndex];\n    initialized.current = true;\n    requestTransform(shiftXCurrentRef.current);\n  };\n\n  var onResize = function () {\n    if (initialized.current) {\n      initializeSlides();\n    }\n  };\n\n  useGlobalEventListener(window, \"resize\", onResize);\n  useIsomorphicLayoutEffect(function performSlideChange() {\n    if (!initialized.current) {\n      return;\n    }\n\n    var _slidesManager_current = slidesManager.current,\n        snaps = _slidesManager_current.snaps,\n        slides = _slidesManager_current.slides;\n    var indent = snaps[slideIndex];\n    var startPoint = shiftXCurrentRef.current;\n    /**\n    * Переключаемся с последнего элемента на первый\n    * Для корректной анимации мы прокручиваем последний слайд на всю длину (shiftX) \"вперед\"\n    * В конце анимации при отрисовке следующего кадра задаем всем слайдам начальные значения\n    */\n\n    if (indent === snaps[0] && shiftXCurrentRef.current <= snaps[snaps.length - 1]) {\n      var distance = Math.abs(snaps[snaps.length - 1]) + slides[slides.length - 1].width + startPoint;\n      addToAnimationQueue(getAnimateFunction(function (progress) {\n        var shiftX = startPoint + progress * distance * -1;\n        transformCssStyles(shiftX);\n\n        if (shiftX <= snaps[snaps.length - 1] - slides[slides.length - 1].width) {\n          requestAnimationFrame(function () {\n            shiftXCurrentRef.current = indent;\n            transformCssStyles(snaps[0]);\n          });\n        }\n      }));\n      /**\n       * Переключаемся с первого слайда на последний\n       * Для корректной анимации сначала задаем первым видимым слайдам смещение\n       * В следующем кадре начинаем анимация прокрутки \"назад\"\n       */\n    } else if (indent === snaps[snaps.length - 1] && shiftXCurrentRef.current === snaps[0]) {\n      startPoint = indent - slides[slides.length - 1].width;\n      addToAnimationQueue(function () {\n        requestAnimationFrame(function () {\n          var shiftX = indent - slides[slides.length - 1].width;\n          transformCssStyles(shiftX);\n          getAnimateFunction(function (progress) {\n            transformCssStyles(startPoint + progress * slides[slides.length - 1].width);\n          })();\n        });\n      });\n      /**\n       * Если не обработаны `corner`-кейсы выше, то просто проигрываем анимацию смещения\n       */\n    } else {\n      addToAnimationQueue(function () {\n        var distance = Math.abs(indent - startPoint);\n        var direction = startPoint <= indent ? 1 : -1;\n        getAnimateFunction(function (progress) {\n          var shiftX = startPoint + progress * distance * direction;\n          transformCssStyles(shiftX);\n        })();\n      });\n    }\n\n    startAnimation();\n    shiftXCurrentRef.current = indent;\n  }, [slideIndex]);\n  useIsomorphicLayoutEffect(function () {\n    initializeSlides();\n  }, [children, align, slideWidth]);\n\n  var slideLeft = function (event) {\n    onChange === null || onChange === void 0 ? void 0 : onChange((slideIndex - 1 + slidesManager.current.slides.length) % slidesManager.current.slides.length);\n    onPrevClick === null || onPrevClick === void 0 ? void 0 : onPrevClick(event);\n  };\n\n  var slideRight = function (event) {\n    onChange === null || onChange === void 0 ? void 0 : onChange((slideIndex + 1) % slidesManager.current.slides.length);\n    onNextClick === null || onNextClick === void 0 ? void 0 : onNextClick(event);\n  };\n\n  var onStart = function (e) {\n    e.originalEvent.stopPropagation();\n    onDragStart === null || onDragStart === void 0 ? void 0 : onDragStart(e);\n    shiftXCurrentRef.current = slidesManager.current.snaps[slideIndex];\n    shiftXDeltaRef.current = 0;\n  };\n\n  var onMoveX = function (e) {\n    if (isDraggableProp && !slidesManager.current.isFullyVisible) {\n      e.originalEvent.preventDefault();\n\n      if (e.isSlideX) {\n        if (shiftXDeltaRef.current !== e.shiftX) {\n          shiftXDeltaRef.current = e.shiftX;\n          requestTransform(shiftXCurrentRef.current + shiftXDeltaRef.current);\n        }\n      }\n    }\n  };\n\n  var onEnd = function (e) {\n    var targetIndex = slideIndex;\n\n    if (e.isSlide) {\n      targetIndex = getTargetIndex(slidesManager.current.slides, slideIndex, shiftXCurrentRef.current, shiftXDeltaRef.current);\n    }\n\n    onDragEnd === null || onDragEnd === void 0 ? void 0 : onDragEnd(e, targetIndex);\n\n    if (targetIndex !== slideIndex) {\n      shiftXCurrentRef.current = shiftXCurrentRef.current + shiftXDeltaRef.current;\n      onChange === null || onChange === void 0 ? void 0 : onChange(targetIndex);\n    } else {\n      var initialShiftX = slidesManager.current.snaps[targetIndex];\n      requestTransform(initialShiftX, true);\n    }\n  };\n\n  var setSlideRef = function (slideRef, slideIndex) {\n    slidesStore.current[slideIndex] = slideRef;\n  };\n\n  var canSlideLeft = controlElementsState.canSlideLeft,\n      canSlideRight = controlElementsState.canSlideRight,\n      isDraggable = controlElementsState.isDraggable;\n  return /*#__PURE__*/React.createElement(RootComponent, _object_spread_props(_object_spread({}, restProps), {\n    baseClassName: classNames(\"vkuiBaseGallery\", slideWidth === \"custom\" && \"vkuiBaseGallery--custom-width\", isDraggable && \"vkuiBaseGallery--draggable\"),\n    getRootRef: rootRef\n  }), /*#__PURE__*/React.createElement(Touch, {\n    className: \"vkuiBaseGallery__viewport\",\n    onStartX: onStart,\n    onMoveX: onMoveX,\n    onEnd: onEnd,\n    style: {\n      width: slideWidth === \"custom\" ? \"100%\" : slideWidth\n    },\n    getRootRef: viewportRef,\n    noSlideClick: true\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"vkuiBaseGallery__layer\",\n    ref: layerRef\n  }, React.Children.map(children, function (item, i) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"vkuiBaseGallery__slide\",\n      key: \"slide-\".concat(i),\n      ref: function (el) {\n        return setSlideRef(el, i);\n      }\n    }, item);\n  }))), bullets && /*#__PURE__*/React.createElement(\"div\", {\n    \"aria-hidden\": true,\n    className: classNames(\"vkuiBaseGallery__bullets\", stylesBullets[bullets])\n  }, React.Children.map(children, function (_item, index) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: classNames(\"vkuiBaseGallery__bullet\", index === slideIndex && \"vkuiBaseGallery__bullet--active\"),\n      key: index\n    });\n  })), showArrows && hasPointer && canSlideLeft && /*#__PURE__*/React.createElement(ScrollArrow, {\n    className: \"vkuiBaseGallery__arrow\",\n    direction: \"left\",\n    onClick: slideLeft,\n    size: arrowSize\n  }), showArrows && hasPointer && canSlideRight && /*#__PURE__*/React.createElement(ScrollArrow, {\n    className: \"vkuiBaseGallery__arrow\",\n    direction: \"right\",\n    onClick: slideRight,\n    size: arrowSize\n  }));\n};","map":{"version":3,"mappings":"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","names":["React","classNames","useAdaptivityHasPointer","useExternRef","useGlobalEventListener","useDOM","useIsomorphicLayoutEffect","warnOnce","RootComponent","ScrollArrow","Touch","ANIMATION_DURATION","CONTROL_ELEMENTS_STATE","SLIDES_MANAGER_STATE","calculateIndent","getLoopPoints","getTargetIndex","useSlideAnimation","stylesBullets","dark","light","warn","CarouselBase","bullets","_param_bullets","getRootRef","children","slideWidth","_param_slideWidth","_param_slideIndex","slideIndex","isDraggableProp","isDraggable","onDragStart","onDragEnd","onChange","onPrevClick","onNextClick","align","_param_align","showArrows","getRef","arrowSize","_param_arrowSize","restProps","slidesStore","useRef","slidesManager","rootRef","viewportRef","layerRef","animationFrameRef","shiftXCurrentRef","shiftXDeltaRef","initialized","addToAnimationQueue","getAnimateFunction","startAnimation","useState","controlElementsState","setControlElementsState","window","hasPointer","isCenterWithCustomWidth","transformCssStyles","shiftX","animation","current","loopPoints","forEach","loopPoint","target","index","slide","style","transform","concat","transition","requestTransform","snaps","contentSize","slides","cancelAnimationFrame","requestAnimationFrame","lastPoint","length","width","coordX","Math","abs","initializeSlides","localSlides","Children","map","_item","i","elem","offsetLeft","offsetWidth","containerWidth","viewportOffsetWidth","layerWidth","reduce","val","process","env","NODE_ENV","remainingWidth","firstSlideShift","item","_object_spread_props","isFullyVisible","_","canSlideLeft","canSlideRight","onResize","performSlideChange","indent","startPoint","distance","progress","direction","slideLeft","event","slideRight","onStart","e","originalEvent","stopPropagation","onMoveX","preventDefault","isSlideX","onEnd","targetIndex","isSlide","initialShiftX","setSlideRef","slideRef","baseClassName","className","onStartX","noSlideClick","div","ref","key","el","aria-hidden","onClick","size"],"sources":["C:\\Users\\kulag\\vk\\Ability\\node_modules\\@vkontakte\\vkui\\src\\components\\BaseGallery\\CarouselBase\\CarouselBase.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivityHasPointer } from '../../../hooks/useAdaptivityHasPointer';\nimport { useExternRef } from '../../../hooks/useExternRef';\nimport { useGlobalEventListener } from '../../../hooks/useGlobalEventListener';\nimport { useDOM } from '../../../lib/dom';\nimport { useIsomorphicLayoutEffect } from '../../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../../lib/warnOnce';\nimport { RootComponent } from '../../RootComponent/RootComponent';\nimport { ScrollArrow } from '../../ScrollArrow/ScrollArrow';\nimport { Touch, TouchEvent } from '../../Touch/Touch';\nimport { BaseGalleryProps, GallerySlidesState } from '../types';\nimport { ANIMATION_DURATION, CONTROL_ELEMENTS_STATE, SLIDES_MANAGER_STATE } from './constants';\nimport { calculateIndent, getLoopPoints, getTargetIndex } from './helpers';\nimport { useSlideAnimation } from './hooks';\nimport { ControlElementsState, SlidesManagerState } from './types';\nimport styles from '../BaseGallery.module.css';\n\nconst stylesBullets = {\n  dark: styles['BaseGallery__bullets--dark'],\n  light: styles['BaseGallery__bullets--light'],\n};\n\nconst warn = warnOnce('Gallery');\n\nexport const CarouselBase = ({\n  bullets = false,\n  getRootRef,\n  children,\n  slideWidth = '100%',\n  slideIndex = 0,\n  isDraggable: isDraggableProp = true,\n  onDragStart,\n  onDragEnd,\n  onChange,\n  onPrevClick,\n  onNextClick,\n  align = 'left',\n  showArrows,\n  getRef,\n  arrowSize = 'l',\n  ...restProps\n}: BaseGalleryProps) => {\n  const slidesStore = React.useRef<Record<string, HTMLDivElement | null>>({});\n  const slidesManager = React.useRef<SlidesManagerState>(SLIDES_MANAGER_STATE);\n\n  const rootRef = useExternRef(getRootRef);\n  const viewportRef = useExternRef(getRef);\n  const layerRef = React.useRef<HTMLDivElement>(null);\n  const animationFrameRef = React.useRef<ReturnType<typeof requestAnimationFrame> | null>(null);\n  const shiftXCurrentRef = React.useRef<number>(0);\n  const shiftXDeltaRef = React.useRef<number>(0);\n  const initialized = React.useRef<boolean>(false);\n  const { addToAnimationQueue, getAnimateFunction, startAnimation } = useSlideAnimation();\n\n  const [controlElementsState, setControlElementsState] =\n    React.useState<ControlElementsState>(CONTROL_ELEMENTS_STATE);\n\n  const { window } = useDOM();\n  const hasPointer = useAdaptivityHasPointer();\n\n  const isCenterWithCustomWidth = slideWidth === 'custom' && align === 'center';\n\n  const transformCssStyles = (shiftX: number, animation = false) => {\n    slidesManager.current.loopPoints.forEach((loopPoint) => {\n      const { target, index } = loopPoint;\n      const slide = slidesStore.current[index];\n      if (slide) {\n        slide.style.transform = `translate3d(${target(shiftX)}px, 0, 0)`;\n      }\n    });\n\n    if (layerRef.current) {\n      layerRef.current.style.transform = `translate3d(${shiftX}px, 0, 0)`;\n      layerRef.current.style.transition = animation\n        ? `transform ${ANIMATION_DURATION}ms cubic-bezier(.1, 0, .25, 1)`\n        : '';\n    }\n  };\n\n  const requestTransform = (shiftX: number, animation = false) => {\n    const { snaps, contentSize, slides } = slidesManager.current;\n\n    if (animationFrameRef.current !== null) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    animationFrameRef.current = requestAnimationFrame(() => {\n      if (shiftX > snaps[0]) {\n        shiftXCurrentRef.current = -contentSize + snaps[0];\n        shiftX = shiftXCurrentRef.current + shiftXDeltaRef.current;\n      }\n      const lastPoint = slides[slides.length - 1].width + slides[slides.length - 1].coordX;\n\n      if (shiftX <= -lastPoint) {\n        shiftXCurrentRef.current = Math.abs(shiftXDeltaRef.current) + snaps[0];\n      }\n      transformCssStyles(shiftX, animation);\n    });\n  };\n\n  const initializeSlides = () => {\n    if (!rootRef.current || !viewportRef.current) {\n      return;\n    }\n    let localSlides =\n      React.Children.map(children, (_item, i): GallerySlidesState => {\n        const elem = slidesStore.current[i] || { offsetLeft: 0, offsetWidth: 0 };\n        return { coordX: elem.offsetLeft, width: elem.offsetWidth };\n      }) || [];\n\n    const containerWidth = rootRef.current.offsetWidth;\n    const viewportOffsetWidth = viewportRef.current.offsetWidth;\n    const layerWidth = localSlides.reduce((val, slide) => slide.width + val, 0);\n\n    if (process.env.NODE_ENV === 'development') {\n      let remainingWidth = containerWidth;\n      let slideIndex = 0;\n\n      while (remainingWidth > 0 && slideIndex < localSlides.length) {\n        remainingWidth -= localSlides[slideIndex].width;\n        slideIndex++;\n      }\n      if (remainingWidth <= 0 && slideIndex === localSlides.length) {\n        warn(\n          'Ширины слайдов недостаточно для корректной работы свойства \"looped\". Пожалуйста, сделайте её больше.\"',\n        );\n      }\n    }\n    if (align === 'center') {\n      const firstSlideShift = (containerWidth - localSlides[0].width) / 2;\n      localSlides = localSlides.map((item) => {\n        return {\n          width: item.width,\n          coordX: item.coordX - firstSlideShift,\n        };\n      });\n    }\n\n    slidesManager.current = {\n      ...slidesManager.current,\n      viewportOffsetWidth,\n      slides: localSlides,\n      isFullyVisible: layerWidth <= containerWidth,\n    };\n\n    const snaps = localSlides.map((_, index) =>\n      calculateIndent(index, slidesManager.current, isCenterWithCustomWidth),\n    );\n\n    let contentSize = -snaps[snaps.length - 1] + localSlides[localSlides.length - 1].width;\n    if (align === 'center') {\n      contentSize += snaps[0];\n    }\n\n    slidesManager.current.snaps = snaps;\n    slidesManager.current.contentSize = contentSize;\n    slidesManager.current.loopPoints = getLoopPoints(slidesManager.current, containerWidth);\n\n    setControlElementsState({\n      canSlideLeft: !slidesManager.current.isFullyVisible,\n      canSlideRight: !slidesManager.current.isFullyVisible,\n      isDraggable: isDraggableProp && !slidesManager.current.isFullyVisible,\n    });\n\n    shiftXCurrentRef.current = snaps[slideIndex];\n    initialized.current = true;\n\n    requestTransform(shiftXCurrentRef.current);\n  };\n\n  const onResize = () => {\n    if (initialized.current) {\n      initializeSlides();\n    }\n  };\n\n  useGlobalEventListener(window, 'resize', onResize);\n\n  useIsomorphicLayoutEffect(\n    function performSlideChange() {\n      if (!initialized.current) {\n        return;\n      }\n      const { snaps, slides } = slidesManager.current;\n      const indent = snaps[slideIndex];\n      let startPoint = shiftXCurrentRef.current;\n\n      /**\n       * Переключаемся с последнего элемента на первый\n       * Для корректной анимации мы прокручиваем последний слайд на всю длину (shiftX) \"вперед\"\n       * В конце анимации при отрисовке следующего кадра задаем всем слайдам начальные значения\n       */\n      if (indent === snaps[0] && shiftXCurrentRef.current <= snaps[snaps.length - 1]) {\n        const distance =\n          Math.abs(snaps[snaps.length - 1]) + slides[slides.length - 1].width + startPoint;\n\n        addToAnimationQueue(\n          getAnimateFunction((progress) => {\n            const shiftX = startPoint + progress * distance * -1;\n\n            transformCssStyles(shiftX);\n\n            if (shiftX <= snaps[snaps.length - 1] - slides[slides.length - 1].width) {\n              requestAnimationFrame(() => {\n                shiftXCurrentRef.current = indent;\n                transformCssStyles(snaps[0]);\n              });\n            }\n          }),\n        );\n        /**\n         * Переключаемся с первого слайда на последний\n         * Для корректной анимации сначала задаем первым видимым слайдам смещение\n         * В следующем кадре начинаем анимация прокрутки \"назад\"\n         */\n      } else if (indent === snaps[snaps.length - 1] && shiftXCurrentRef.current === snaps[0]) {\n        startPoint = indent - slides[slides.length - 1].width;\n\n        addToAnimationQueue(() => {\n          requestAnimationFrame(() => {\n            const shiftX = indent - slides[slides.length - 1].width;\n            transformCssStyles(shiftX);\n\n            getAnimateFunction((progress) => {\n              transformCssStyles(startPoint + progress * slides[slides.length - 1].width);\n            })();\n          });\n        });\n        /**\n         * Если не обработаны `corner`-кейсы выше, то просто проигрываем анимацию смещения\n         */\n      } else {\n        addToAnimationQueue(() => {\n          const distance = Math.abs(indent - startPoint);\n          let direction = startPoint <= indent ? 1 : -1;\n\n          getAnimateFunction((progress) => {\n            const shiftX = startPoint + progress * distance * direction;\n            transformCssStyles(shiftX);\n          })();\n        });\n      }\n\n      startAnimation();\n\n      shiftXCurrentRef.current = indent;\n    },\n    [slideIndex],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    initializeSlides();\n  }, [children, align, slideWidth]);\n\n  const slideLeft = (event: React.MouseEvent) => {\n    onChange?.(\n      (slideIndex - 1 + slidesManager.current.slides.length) % slidesManager.current.slides.length,\n    );\n    onPrevClick?.(event);\n  };\n\n  const slideRight = (event: React.MouseEvent) => {\n    onChange?.((slideIndex + 1) % slidesManager.current.slides.length);\n    onNextClick?.(event);\n  };\n\n  const onStart = (e: TouchEvent) => {\n    e.originalEvent.stopPropagation();\n    onDragStart?.(e);\n    shiftXCurrentRef.current = slidesManager.current.snaps[slideIndex];\n    shiftXDeltaRef.current = 0;\n  };\n\n  const onMoveX = (e: TouchEvent) => {\n    if (isDraggableProp && !slidesManager.current.isFullyVisible) {\n      e.originalEvent.preventDefault();\n\n      if (e.isSlideX) {\n        if (shiftXDeltaRef.current !== e.shiftX) {\n          shiftXDeltaRef.current = e.shiftX;\n          requestTransform(shiftXCurrentRef.current + shiftXDeltaRef.current);\n        }\n      }\n    }\n  };\n\n  const onEnd = (e: TouchEvent) => {\n    let targetIndex = slideIndex;\n    if (e.isSlide) {\n      targetIndex = getTargetIndex(\n        slidesManager.current.slides,\n        slideIndex,\n        shiftXCurrentRef.current,\n        shiftXDeltaRef.current,\n      );\n    }\n    onDragEnd?.(e, targetIndex);\n\n    if (targetIndex !== slideIndex) {\n      shiftXCurrentRef.current = shiftXCurrentRef.current + shiftXDeltaRef.current;\n      onChange?.(targetIndex);\n    } else {\n      const initialShiftX = slidesManager.current.snaps[targetIndex];\n      requestTransform(initialShiftX, true);\n    }\n  };\n\n  const setSlideRef = (slideRef: HTMLDivElement | null, slideIndex: number) => {\n    slidesStore.current[slideIndex] = slideRef;\n  };\n\n  const { canSlideLeft, canSlideRight, isDraggable } = controlElementsState;\n\n  return (\n    <RootComponent\n      {...restProps}\n      baseClassName={classNames(\n        styles['BaseGallery'],\n        slideWidth === 'custom' && styles['BaseGallery--custom-width'],\n        isDraggable && styles['BaseGallery--draggable'],\n      )}\n      getRootRef={rootRef}\n    >\n      <Touch\n        className={styles['BaseGallery__viewport']}\n        onStartX={onStart}\n        onMoveX={onMoveX}\n        onEnd={onEnd}\n        style={{ width: slideWidth === 'custom' ? '100%' : slideWidth }}\n        getRootRef={viewportRef}\n        noSlideClick\n      >\n        <div className={styles['BaseGallery__layer']} ref={layerRef}>\n          {React.Children.map(children, (item: React.ReactNode, i: number) => (\n            <div\n              className={styles['BaseGallery__slide']}\n              key={`slide-${i}`}\n              ref={(el) => setSlideRef(el, i)}\n            >\n              {item}\n            </div>\n          ))}\n        </div>\n      </Touch>\n\n      {bullets && (\n        <div\n          aria-hidden\n          className={classNames(styles['BaseGallery__bullets'], stylesBullets[bullets])}\n        >\n          {React.Children.map(children, (_item: React.ReactNode, index: number) => (\n            <div\n              className={classNames(\n                styles['BaseGallery__bullet'],\n                index === slideIndex && styles['BaseGallery__bullet--active'],\n              )}\n              key={index}\n            />\n          ))}\n        </div>\n      )}\n\n      {showArrows && hasPointer && canSlideLeft && (\n        <ScrollArrow\n          className={styles['BaseGallery__arrow']}\n          direction=\"left\"\n          onClick={slideLeft}\n          size={arrowSize}\n        />\n      )}\n      {showArrows && hasPointer && canSlideRight && (\n        <ScrollArrow\n          className={styles['BaseGallery__arrow']}\n          direction=\"right\"\n          onClick={slideRight}\n          size={arrowSize}\n        />\n      )}\n    </RootComponent>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}